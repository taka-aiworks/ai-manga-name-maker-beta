# ネーム制作ツール - プロジェクト状況ファイル（スナップ設定UI＆分割作業版）

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas + jsPDF + html2canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月9日（スナップ設定UI実装＆コード分割）
- **最新機能**: カスタマイズ可能なスナップ設定UI + 大規模コード分割によるメンテナンス性向上

## 現在の実装状況

### 完了機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### 🆕 スナップ設定UI機能（NEW!）
- **✅ スナップON/OFF**: ワンクリックで有効/無効切り替え
- **📐 グリッドサイズ選択**: 10px / 20px / 40px から選択可能
- **⚙️ スナップ感度調整**: 弱(6px) / 中(12px) / 強(20px) の3段階
- **👁️ グリッド表示設定**: 常時表示 / 編集時のみ / 非表示
- **🎯 リアルタイム反映**: 設定変更が即座にキャンバスに反映
- **📊 状態表示**: 現在のスナップ設定を右上に表示

#### コマ操作機能（COMPLETE!）
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
- **🆕 カスタマイズ可能スナップ機能**: ユーザー設定に基づく自動位置合わせ
- **補助線表示**: 移動中に破線ガイド表示（設定可能）
- **🆕 設定可能グリッド表示**: サイズ・表示タイミングをカスタマイズ
- **コマリサイズ**: 8方向ハンドル
- **コマ分割**: 紫のハサミボタン（右下角）
- **コマ削除**: 複数の削除方法
- **コマ複製**: 右クリック「📋 コマ複製」でパネル内要素も一緒に複製

#### パネルテンプレート自動配置（COMPLETE!）
- **6種類のテンプレート**に専用シーン自動配置
- **自動配置要素**: キャラクター・吹き出し・斜め方向機能活用

#### 吹き出し機能
- 自由移動（パネル外移動可能）
- 3方向リサイズ
- ダブルクリック編集
- 4種類の形状
- 右クリックメニュー
- **Delete/Backspaceキー削除**: 選択中の吹き出しを削除

#### キャラクター機能
- 絶対座標での自由移動
- 8方向リサイズハンドル
- 表示タイプ切り替え
- 4種類のキャラクター
- **8方向の顔の角度**
- **9方向の視線**
- **斜め方向描画システム**
- **表情システム**: 8種類
- **ポーズシステム**: 6種類
- **キャラクター複製**: 右クリック「👥 キャラクター複製」で複製

#### コピー&ペースト機能（COMPLETE!）
- **Ctrl+C**: 選択中の要素（コマ・キャラ・吹き出し）をコピー
- **Ctrl+V**: コピーした要素をペースト
- **右クリックメニュー**: 「📋 コピー」「📌 ペースト」ボタン
- **クリップボード表示**: 右上にコピー中の要素を表示
- **Delete/Backspace**: 選択中の要素を削除
- **Escape**: 選択解除

#### エクスポート機能（COMPLETE!）
- **PDF出力**: ネーム用レイアウト（A4サイズ自動調整）
- **PNG画像出力**: 高画質画像ファイル
- **PSD（クリスタ用）出力**: レイヤー構造付きデータ

#### エクスポートUI（統一完成版）
- **ワンクリック開閉システム**: 同じボタンで設定展開・収納
- **既存UI完全統一**: ダークモード・フォント・色・サイズすべて統一
- **用途別最適化設定**: 印刷用PDF・画像保存・クリスタ用の専用設定
- **プログレス表示**: リアルタイム進行状況（オレンジプログレスバー）

#### 反転機能
- **水平反転**: 左右反転
- **垂直反転**: 上下反転
- **編集モード時のみ利用可能**

#### 操作機能
- アンドゥ/リドゥ機能
- 要素削除
- キーボードショートカット対応
- 右クリックコンテキストメニュー
- **🆕 カスタマイズ可能スナップ機能**

#### UI機能
- デフォルトダークモード
- ライト/ダークモード切り替え
- 左右サイドバーレイアウト
- コマ編集モード表示
- 操作状態表示
- **🆕 スナップ設定UI**: 上部ツールバーに統合されたインライン設定

### 🎉 最新達成項目（2025-09-09）
1. ✅ **スナップ設定UI実装**: グリッドサイズ・感度・表示設定の完全カスタマイズ
2. ✅ **PanelManager分割**: パネル操作ロジックを独立モジュール化（350行分離）
3. ✅ **ContextMenuHandler分割**: 右クリックメニュー処理を独立モジュール化（250行分離）
4. ✅ **型定義拡張**: SnapSettings型の追加とCanvasComponentProps更新
5. ✅ **設定連携システム**: App.tsx → CanvasComponent.tsx → PanelManager.ts の完全な設定伝達
6. ✅ **コードベース最適化**: CanvasComponent.tsx を1000行 → 600行に削減（40%削減）

### 🐛 既知のバグ
- **現在、重大なバグはありません！** 🎉

### 🚀 次に追加したい機能

#### 優先度：高（基本機能拡張）
1. **🔍 ズーム機能**: 細かい作業のための拡大縮小
2. **📏 ルーラー・ガイド機能**: より正確な配置のための補助線
3. **🧹 コード分割完了**: 残りのCanvasComponent.tsx分割（描画・イベント処理）

#### 優先度：中（機能充実）
1. **🎨 背景・小物システム**: 効果線・集中線の追加
2. **💾 表情・ポーズプリセット保存**: ユーザー独自の組み合わせ保存
3. **📝 セリフフォント設定**: 縦書き/横書き、フォントサイズ調整
4. **🎯 レイヤー機能**: 要素の重ね順管理

#### 優先度：革新的機能（次世代ネーム制作）
1. **🤖 ChatGPT API連携**: AIによるストーリー相談・アイデア出し機能
2. **🎯 3Dキャラクター表示**: より直感的なポーズ・表情設定
3. **📝 プロンプトメーカー連携**: AIイラスト生成用のプロンプト自動作成

## 🏗️ 最新ファイル構造（分割後）
```
src/
├── types.ts                    # 共通型定義（SnapSettings追加）
├── App.tsx                     # メインアプリ（スナップ設定UI付き）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（600行、分割済み）
│   ├── UI/
│   │   ├── CharacterDetailPanel.tsx # キャラクター詳細設定
│   │   └── ExportPanel.tsx          # エクスポートUI
│   └── CanvasArea/
│       ├── PanelManager.ts          # 🆕 パネル操作ロジック（350行）
│       ├── ContextMenuHandler.ts    # 🆕 右クリックメニュー処理（250行）
│       ├── EditBubbleModal.tsx      # 編集モーダル
│       ├── templates.ts             # パネルテンプレート定義
│       ├── sceneTemplates.ts        # シーンテンプレート定義
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作
│           └── PanelRenderer.tsx     # パネル描画・操作
├── services/
│   └── ExportService.ts        # エクスポート機能中核
```

## 重要な技術詳細

### 🆕 スナップ設定システムの実装
- **型安全な設定管理**: TypeScriptによる完全な型定義
- **リアクティブ設定**: 設定変更が即座にキャンバスに反映
- **プロップスドリリング**: App.tsx → CanvasComponent.tsx → PanelManager.ts
- **パフォーマンス最適化**: 設定無効時の早期リターンによる処理軽減
- **感度変換システム**: weak/medium/strong → 6px/12px/20px への自動変換

### 🏗️ コード分割アーキテクチャ
- **PanelManager**: 静的クラスによるパネル操作の完全分離
- **ContextMenuHandler**: 右クリックメニューの処理とレンダリング分離
- **型定義の統一**: 各モジュール間での一貫した型使用
- **依存関係の最小化**: 各モジュールが独立して動作可能

### コピペ機能の実装
- **clipboard状態管理**: `useState`でコピー中の要素を管理
- **キーボードイベント**: `addEventListener('keydown')`でCtrl+C/V を監視
- **要素複製**: 新しいIDを生成して位置をずらして配置
- **型安全性**: TypeScriptで型チェック済み

### 座標系
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標 + 相対座標（互換性）
- **パネル**: 絶対座標

### コマ操作システム
- **移動**: 中央の青い円形ハンドル + **カスタマイズ可能スナップ機能**
- **リサイズ**: 8方向ハンドル + 感度調整
- **分割**: 右下角のハサミボタン
- **削除**: 複数の削除方法
- **複製**: 右クリックメニューとCtrl+C/V

## 操作方法

### 基本操作
- **左クリック**: 要素選択
- **右クリック**: コンテキストメニュー表示
- **ダブルクリック**: 吹き出し編集
- **ドラッグ**: 要素移動

### キーボードショートカット
- **Ctrl+C**: コピー
- **Ctrl+V**: ペースト
- **Delete/Backspace**: 削除
- **Escape**: 選択解除
- **Ctrl+E**: 編集モード切り替え

### 🆕 スナップ設定操作
- **✅ スナップボタン**: スナップ機能のON/OFF切り替え
- **グリッドサイズ**: 10px / 20px / 40px から選択
- **感度設定**: 弱 / 中 / 強 から選択
- **グリッド表示**: 常時 / 編集時 / 非表示 から選択

### 右クリックメニュー
#### パネル（コマ）
- 🔧 コマ編集
- 📋 コマ複製
- 📋 コピー (Ctrl+C)
- ↔️ 水平反転（編集モード時）
- ↕️ 垂直反転（編集モード時）
- ✂️ 水平分割 / 垂直分割
- 🗑️ コマ削除

#### キャラクター
- 詳細設定
- 👥 キャラクター複製
- 📋 コピー (Ctrl+C)
- 削除

#### 吹き出し
- 選択
- 📋 コピー (Ctrl+C)
- 削除

#### 空の場所
- 📌 ペースト (Ctrl+V) ※クリップボードに要素がある時のみ
- 選択解除

## 起動方法
```bash
# 基本起動
npm start

# エクスポート用ライブラリ
npm install jspdf html2canvas @types/jspdf

# http://localhost:3000 でアクセス
```

## よくある問題と解決法
- **コマ操作が効かない**: 編集モード（🔧）をONにする
- **反転メニューが表示されない**: 編集モードをONにしてパネルを右クリック
- **コピペが効かない**: 要素を選択してからCtrl+C/V
- **吹き出しが削除できない**: 吹き出しを選択してDelete/Backspaceキー
- **🆕 スナップが効かない**: 上部ツールバーの✅スナップボタンがONになっているか確認
- **🆕 グリッドが表示されない**: グリッド表示設定を「常時」または「編集時」に変更

## プロジェクト達成状況

### Phase 1: 基本機能 ✅
- Canvas描画、キャラクター・吹き出し操作、テンプレート機能

### Phase 2: 高度な表現 ✅  
- 斜め方向、表情・ポーズシステム、シーンテンプレート

### Phase 3: コマ操作・自動化 ✅
- コマの移動・リサイズ・分割、パネルテンプレート自動配置

### Phase 4: コマ管理・UX向上 ✅
- コマ削除、右クリック拡張、感度調整

### Phase 5: グリッド・スナップ機能 ✅
- グリッド表示、右クリック編集、スナップ機能

### Phase 6: エクスポート機能 ✅
- PDF出力、PNG画像出力、PSD（クリスタ用）出力

### Phase 6.5: UI統一・完成度向上 ✅
- エクスポートUI既存統一、ダークモード完全対応、型エラー修正

### Phase 7: コピペ・複製機能 ✅
- コマ複製、キャラクター複製、Ctrl+C/V コピペ機能

### 🆕 Phase 8: スナップ設定UI＆コード分割 ✅ **← 今回完了！**
- **スナップ設定UI**: 完全カスタマイズ可能なスナップ機能
- **大規模コード分割**: メンテナンス性の大幅向上（40%コード削減）
- **型安全性向上**: 完全なTypeScript型定義

### Phase 9: 次の目標 🔜
- ズーム機能、ルーラー機能、残コード分割完了

**現在の進捗率: 99% 完了** 🚀

## 🏆 開発ロードマップ

### 短期目標（1-2週間）
1. 🧹 **残りコード分割完了**: CanvasDrawing.ts, MouseEventHandler.ts
2. 🔍 **ズーム機能実装**: マウスホイール + Ctrl でズーム
3. 📏 **ルーラー・ガイド機能実装**: より正確な配置支援

### 中期目標（1ヶ月）
1. 🎨 背景・小物システム実装
2. 💾 プリセット保存機能実装
3. 🎯 レイヤー機能実装

### 長期目標（2-3ヶ月）
1. 🤖 ChatGPT API連携の基礎実装
2. 🎯 3Dキャラクター表示システム
3. 📝 プロンプトメーカー連携完成

## 🎯 技術的成果

### コードベースの改善
- **40%のコード削減**: 1000行 → 600行（CanvasComponent.tsx）
- **モジュール分離**: 2つの独立モジュール追加
- **型安全性向上**: 完全なTypeScript型定義
- **メンテナンス性向上**: 機能別の明確な分離

### ユーザビリティの向上
- **完全カスタマイズ可能**: スナップ機能の全設定をユーザー制御
- **リアルタイム反映**: 設定変更の即座反映
- **直感的操作**: インライン設定UIによる操作性向上
- **視覚的フィードバック**: 設定状態の常時表示

**このスナップ設定UI＆コード分割により、ツールの使いやすさと開発効率が飛躍的に向上しました！** ✨

基本的なネーム制作に必要な機能は完全に完成し、次はさらなる高度機能の実装フェーズに入ります。