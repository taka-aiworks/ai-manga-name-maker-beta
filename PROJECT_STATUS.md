# ネーム制作ツール - プロジェクト状況ファイル

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas + jsPDF + html2canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月17日 23:00
- **現在の状況**: **Phase 13.0: プロンプトメーカー連携システム設計中** 🔄

---

## 🔄 **Phase 13.0: プロンプトメーカー連携システム設計中** 

### 📋 **2025-09-17 23:00 Phase 13.0設計報告**

#### 🎯 **新方針：2層構造のキャラクター管理システム** 🆕
**Phase 12.6での検証結果を受け、機能の根本的な見直しを実施**

1. **問題認識** 🤔
   - 複雑すぎるプロンプト生成ロジック
   - プロンプトメーカーとの機能重複
   - ユーザビリティの課題

2. **新設計方針** 🎯
   - **プロンプトメーカーとの明確な役割分担**
   - **シンプルで実用的な連携システム**
   - **ネーム制作に特化した情報管理**

#### 🔧 **新システム設計詳細**
**2層構造のキャラクター管理**:
```
【グローバル】キャラクター設定
├── 名前: "主人公"
├── プロンプト: [テキストエリア] ← プロンプトメーカーからコピペ
└── 説明: "黒髪ロングの女子高生"

【ローカル】コマ内キャラクターオブジェクト
├── 参照: characterId
├── 表情: surprised, happy, normal
├── ポーズ: standing, sitting, running
├── 向き: left, right, front  
├── 画角: face, halfBody, fullBody
└── 配置: x, y, scale
```

**最終プロンプト出力**:
```
基本プロンプト + コマ別情報 = 統合プロンプト
例: "1girl, long hair, school uniform, surprised, standing"
```

---

## 📈 **現在のプロジェクト完成度**

### **全体進捗: 98%完了 → Phase 13.0 設計段階**
- **基本機能**: 100%完了 ✅
- **プロンプト連携システム**: 0%完了 🆕 ← **新規設計**
- **効果線・トーンシステム**: 実用版に簡略化完了 ✅
- **シーンテンプレート**: 実用版に簡略化完了 ✅
- **キャラクター名前置換**: 100%完了 ✅
- **ページ管理システム**: 100%完了 ✅
- **背景システム**: 100%完了 ✅
- **UI/UX**: 98%完了 ✅
- **型安全性**: 100%完了 ✅

### **Phase 13.0: プロンプトメーカー連携システム設計段階**
1. **2層構造キャラクター管理設計** ← **設計中（2時間）**
2. **キャラクター設定UI拡張** ← **計画中（2時間）**
3. **プロンプト統合出力機能** ← **計画中（1時間）**
4. **型システム拡張** ← **計画中（1時間）**

---

## 🎯 **改訂されたリリース戦略**

### **v1.0 ベータ版: 2025-09-18-19 リリース予定** ← **新方針反映**
- **リリース時期**: Phase 13.0完了後（推定6時間後）
- **完成度**: 99%（実用性重視）
- **重点機能**: 
  - プロンプトメーカー連携システム 🆕
  - 2層構造キャラクター管理 🆕
  - シンプル化されたテンプレート機能 ✅
  - 実用版効果線・トーン（13種類→5+8種類） ✅
- **差別化機能**: 
  - **世界初**: ネーム制作とAI生成の完全連携 🆕
  - 複数ページ管理システム ✅
  - 実用的なシーンテンプレート機能 ✅
  - プロンプトメーカー統合ワークフロー 🆕

### **フォーカス変更（確定版）**
- **複雑な自動生成** → **シンプルな連携システム**
- **単体完結** → **プロンプトメーカーとの協業**
- **機能網羅** → **実用性・使いやすさ重視**

---

## 🚀 **Phase 13.0: 新連携システム実装詳細**

### **実装項目と進捗**

#### **1. 型システム拡張** 🔧
**新型定義**:
```typescript
// キャラクター設定（グローバル）
interface CharacterSettings {
  id: string;
  name: string;
  basePrompt?: string;    // プロンプトメーカーからコピペ
  description?: string;   // 日本語説明
}

// コマ内キャラクター（ローカル）
interface Character {
  characterId: string;    // 設定への参照
  expression: string;     // surprised, happy, normal
  pose: string;          // standing, sitting, running
  facing: string;        // left, right, front
  viewType: string;      // face, halfBody, fullBody
  x, y, scale: number;   // 配置情報
}
```

#### **2. UI拡張実装** 📱
**CharacterSettingsPanel.tsx拡張**:
- キャラクター設定一覧表示
- プロンプト入力用テキストエリア（任意）
- 新規キャラクター設定追加機能

**CharacterDetailPanel.tsx拡張**:
- 設定参照選択ドロップダウン
- コマ別表情・ポーズ選択
- 向き・画角の視覚的選択

#### **3. プロンプト統合出力** 🔄
**統合ロジック**:
```javascript
generateFinalPrompt(character) {
  const settings = getCharacterSettings(character.characterId);
  const baseParts = settings.basePrompt?.split(', ') || [];
  const localParts = [character.expression, character.pose];
  return [...baseParts, ...localParts].filter(Boolean).join(', ');
}
```

### **推定実装工数**
- **型システム拡張**: 1時間
- **UI拡張実装**: 3時間
- **プロンプト統合機能**: 1時間
- **データ移行・互換性**: 1時間
- **テスト・調整**: 2時間
- **合計**: 8時間（1-2日）

---

## 🏆 **Phase 13.0の目標成果**

### **プロンプトメーカー連携システムの完成**
- **役割分担明確化**: ネーム制作 ↔ プロンプト生成の最適な分業
- **実用的な連携**: コピペベースのシンプルなワークフロー
- **一元管理**: ネームファイル内での制作情報統合
- **制作効率向上**: ネーム → 実制作への完全な橋渡し

### **期待される改善効果**
**従来の問題**:
```
- 複雑すぎる自動生成システム
- プロンプトメーカーとの機能重複
- 設定が分散して管理が困難
```

**Phase 13.0後**:
```
- シンプルな2層構造管理
- 各ツールの得意分野を活用
- ネームファイル内で情報完結
- 制作時の参照性向上
```

### **実用シナリオ**
1. **プロンプトメーカー**でキャラクター詳細設定
2. **ネーム制作ツール**でキャラ設定にコピペ
3. **コマ配置時**に表情・ポーズを個別設定
4. **プロンプト出力**で統合された制作指示を生成
5. **実制作時**に完全な情報セットを活用

---

## 📋 **過去フェーズ履歴**

### **Phase 12.6: プロンプト出力機能改善（完了）** ✅
**2025-09-17 18:00-22:30実施**

#### **実施内容**
1. **辞書統合システム実装** ✅
   - PromptService.ts にて window.DEFAULT_SFW_DICT 対応
   - 辞書データ読み込み確認・動作確認済み
   - カテゴリマッピング修正（hair_length, colors カテゴリ使用）

2. **課題解決** ✅
   - **空パネル問題解決**: パネル別キャラクター取得修正
   - **位置情報削除**: プロンプトから不要な位置情報を除外
   - **TypeScriptエラー修正**: faceExpression型エラー解消

3. **簡略化実装** ✅
   - **効果線**: 13種類→5種類に削減
   - **トーン**: 34種類→8種類に削減
   - **シーンテンプレート**: 13種類→4種類に削減

#### **発見された根本課題**
- 複雑すぎるプロンプト生成ロジック
- プロンプトメーカーとの機能重複
- ユーザビリティの課題
- **→ Phase 13.0での方針転換につながる**

---

## 完了済み主要機能（安定動作中）

### コア機能群
- **Canvas描画システム**: パネル・キャラクター・吹き出し・背景・効果線・トーン表示 ✅
- **8方向リサイズ**: 吹き出し・キャラクター・効果線・トーン完全対応 ✅
- **コマ操作**: 移動・分割・削除・複製（スナップ機能付き）✅
- **コピー&ペースト**: 全要素対応（背景・効果線・トーン完全対応）✅
- **エクスポート**: PDF/PNG/PSD出力（効果線・トーンレイヤー完全対応）✅
- **プロンプト出力**: AI画像生成用プロンプト自動生成（改善→連携システムに移行）🔄
- **キャラクター名前管理**: 動的名前表示・保存機能・完全カスタマイズ ✅
- **ページ管理システム**: 複数ページ対応・完全操作・保存機能 ✅
- **シーンテンプレート**: 実用4種類・ワンクリック適用 ✅
- **2D回転機能**: 完全実装・動作確認済み ✅
- **データ保存・読み込み**: 完全実装・UI統合済み（全データ対応）✅
- **背景機能**: 完全実装・テンプレート対応 ✅
- **効果線機能**: 実用5種類・Canvas統合・操作完全対応 ✅
- **トーン機能**: 実用8種類・Canvas統合・操作対応・パネル統合完了 ✅

### UI・操作性
- **スナップ設定UI**: 完全カスタマイズ対応 ✅
- **ダークモード**: 完全対応 ✅
- **キーボードショートカット**: 主要操作対応（全機能完全対応）✅
- **右クリックメニュー**: 全機能アクセス可能（キャラクター設定完全対応）✅
- **プロジェクト管理UI**: 美しいモーダル・ライト/ダーク対応 ✅
- **ページ管理UI**: タブ・右クリックメニュー・完全操作対応 ✅
- **背景設定UI**: 直感的なテンプレート選択・リアルタイムプレビュー ✅
- **効果線設定UI**: 実用5種類・パラメータ調整・リアルタイムプレビュー・Canvas統合 ✅
- **トーン設定UI**: 実用8種類・リアルタイムプレビュー・Canvas統合・パネル統合完了 ✅
- **シーンテンプレートUI**: 実用4種類・ワンクリック適用・一括配置機能 ✅
- **プロンプト出力UI**: AI画像生成用プロンプト自動生成・コピー・ダウンロード機能（連携システムに移行予定）🔄
- **キャラクター設定UI**: 名前・見た目・役割設定・プロンプト連携・完全カスタマイズ（拡張予定）🔄

---

## 🎉 **過去Phase完了実績**

### **Phase 12.5: シーンテンプレート機能実装完了** ✅
- **EnhancedSceneTemplate実装**: 完全型安全実装・一括配置機能
- **SceneTemplatePanel.tsx完全実装**: 感情・アクション・日常の3カテゴリ
- **システム統合完了**: 既存機能との完全連携・後方互換性

### **Phase 12.4: ページ管理システム実装完了** ✅
- **PageManager.tsx完全実装**: タブUI・右クリックメニュー・完全動作
- **usePageManager.ts状態管理**: 複数ページ管理・切り替え機能
- **SaveService.ts拡張**: ページデータ保存・読み込み対応・後方互換性

### **Phase 12.3: トーンシステム統合完了** ✅
- **ToneRenderer.tsx完全実装**: 6カテゴリ・34パターン→8種類に最適化
- **TonePanel.tsx完全統合**: リアルタイムプレビュー・Canvas統合
- **全システム統合**: 保存・コピペ・エクスポート完全対応

### **Phase 12.2: キャラクター名前置換システム実装完了** ✅
- **App.tsx完全実装**: characterNames/characterSettings状態管理
- **CharacterSettingsPanel.tsx完全修正**: 名前入力フィールド・リアルタイム更新
- **システム統合100%完了**: SaveService.ts・useProjectSave.ts完全対応

### **Phase 12.1: プロンプト出力機能実装完了** ✅
- **ExportPanel.tsx完全リニューアル**: プロンプト出力機能最上位配置
- **カスタムプロンプト生成エンジン実装**: AI画像生成最適化プロンプト構成
- **実用機能完備**: ワンクリック生成・コピー・ダウンロード機能

### **Phase 11.6: 効果線機能統合完了** ✅
- **EffectRenderer.tsx完全実装**: 12種類→5種類に最適化
- **EffectPanel.tsx完全統合**: 4カテゴリ・リアルタイムプレビュー
- **Canvas完全統合**: 描画・操作・保存・エクスポート全対応

### **Phase 11.5: 背景機能実装完了** ✅
- **BackgroundRenderer.tsx完全実装**: 6カテゴリ・テンプレート対応
- **BackgroundPanel.tsx完全統合**: 直感的選択・プレビュー機能
- **システム統合**: Canvas・保存・エクスポート完全対応

---

## 現在のファイル構造（Phase 13.0版）

```
src/
├── types.ts                           # 型定義（2層構造対応予定）🔄
├── components/
│   ├── CanvasComponent.tsx            # Canvas描画（全システム完全統合）✅
│   ├── CanvasComponent/               # Canvas描画システム完全版 ✅
│   ├── UI/
│   │   ├── PageManager.tsx           # ページ管理UI完全実装 ✅
│   │   ├── CharacterDetailPanel.tsx  # キャラクター詳細（拡張予定）🔄
│   │   ├── ExportPanel.tsx           # エクスポート機能（統合プロンプト出力予定）🔄
│   │   ├── ProjectPanel.tsx          # プロジェクト管理（全データ対応・型修正済み）✅
│   │   ├── BackgroundPanel.tsx       # 背景設定UI完全版 ✅
│   │   ├── EffectPanel.tsx           # 効果線設定UI実用版完了 ✅
│   │   ├── TonePanel.tsx             # トーン設定UI実用版完了 ✅
│   │   ├── CharacterSettingsPanel.tsx # キャラクター設定UI（大幅拡張予定）🔄
│   │   ├── SceneTemplatePanel.tsx    # シーンテンプレートUI実用版完了 ✅
│   │   └── TutorialPanel.tsx         # チュートリアル機能（v1.1で実装予定）📋
│   └── CanvasArea/
│       ├── templates.ts               # テンプレート定義完全版 ✅
│       ├── sceneTemplates.ts          # シーンテンプレート実用版完了 ✅
│       ├── backgroundTemplates.ts     # 背景テンプレート完全版 ✅
│       ├── effectTemplates.ts         # 効果線テンプレート実用版完了 ✅
│       ├── toneTemplates.ts           # トーンテンプレート実用版完了 ✅
│       ├── PanelManager.ts            # パネル管理完全版 ✅
│       ├── ContextMenuHandler.ts      # 右クリックメニュー（全機能完全対応）✅
│       └── renderers/
│           ├── BubbleRenderer.tsx     # 吹き出し描画完全版 ✅
│           ├── CharacterRenderer/     # キャラクター描画完全版 ✅
│           ├── PanelRenderer.tsx      # パネル描画完全版 ✅
│           ├── BackgroundRenderer.tsx # 背景描画完全版 ✅
│           ├── EffectRenderer.tsx     # 効果線描画エンジン実用版完了 ✅
│           └── ToneRenderer.tsx       # トーン描画エンジン実用版完了 ✅
├── services/
│   ├── ExportService.ts               # エクスポート（全機能完全対応）✅
│   ├── SaveService.ts                 # 保存（ページ管理対応・後方互換性）✅
│   ├── PromptService.ts               # プロンプト出力機能（統合システムに移行予定）🔄
│   ├── CharacterService.ts            # キャラクター管理（2層構造対応予定）🔄
│   ├── SceneTemplateService.ts        # シーンテンプレート管理実用版完了 ✅
│   ├── PromptIntegrationService.ts    # 統合プロンプトサービス（新規作成予定）🆕
│   └── AIService.ts                   # AI統合サービス（v1.2で実装予定）📋
└── hooks/
    ├── usePageManager.ts              # ページ管理状態hook完全実装 ✅
    ├── useProjectSave.ts              # プロジェクト保存（2層構造対応予定）🔄
    ├── useCanvasDrawing.ts            # Canvas描画（全システム統合・型安全性確保）✅
    ├── useCanvasState.ts              # Canvas状態管理（全機能完全対応）✅
    ├── useMouseEvents.ts              # マウスイベント（全機能完全対応・型安全性確保）✅
    └── useCharacterSettings.ts        # キャラクター設定管理hook（新規作成予定）🆕
```

---

## 継続プロンプト（Phase 13.0版）

```
継続プロンプト: 2025-09-17_プロンプト連携システム_01
チャットタイトル: 開発_プロンプトメーカー連携システム設計_2025-09-17
セッションキー: 2025-09-17_プロンプト連携システム_01
作成日時: 2025-09-17 23:00

コンテキスト: React製ネーム制作ツールのPhase 13.0で、根本的な方針変更を実施。複雑すぎるプロンプト自動生成から、プロンプトメーカーとの連携に特化したシンプルなシステムに移行。2層構造のキャラクター管理により、プロンプト品質と使いやすさを両立させる新アーキテクチャを採用。

進行状況:
- Phase 12.6: 複雑性の課題で方針転換
- Phase 13.0: 新設計段階・2層構造キャラクター管理
- 効果線・トーン・シーンテンプレート: 実用版簡略化完了
- 基本機能: 98%完成・安定動作中

現在の設計:
- グローバルキャラクター設定（名前・プロンプト・説明）
- ローカルキャラクターオブジェクト（表情・ポーズ・向き・画角・配置）
- プロンプト統合出力（基本+コマ別情報の合成）

次のアクション:
優先度1: 2層構造の型システム拡張（CharacterSettings + Character型）
優先度2: キャラクター設定UI拡張（プロンプト入力機能追加）
優先度3: プロンプト統合出力機能実装

必要ツール・機能:
- types.ts の型定義拡張
- CharacterSettingsPanel.tsx の大幅拡張
- 新PromptIntegrationService.ts 作成
- データ移行・後方互換性の確保

継続指示:
Phase 13.0でプロンプトメーカーとの理想的な連携システムを構築してください。2層構造によりシンプルさと実用性を両立し、ネーム制作から実制作までの完全なワークフローを実現してください。複雑な自動生成から、シンプルで確実な連携システムへの移行を完了させてください。
```

---

**Phase 13.0でついに理想的なプロンプトメーカー連携システムを構築します。シンプルで実用的なワークフローの実現を目指します！**