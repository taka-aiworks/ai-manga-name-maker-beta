# ネーム制作ツール - 拡張プロジェクト状況ファイル（AI・3D・プロンプト連携対応版）

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール（AI・3D・プロンプト連携対応）
- **技術スタック**: React + TypeScript + HTML5 Canvas + OpenAI API + Three.js
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月9日（コマ移動・削除・スナップ・グリッド機能開発中）
- **🆕 拡張目標**: ChatGPT連携・3D表示・プロンプト生成システム

## 現在の実装状況

### ✅ 完了機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### 🆕 コマ操作機能（COMPLETE!）
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
  - **🔧 スナップ機能**: 隣接コマとの自動位置合わせ（調整中）
  - **🔧 補助線表示**: 移動中に破線ガイド表示（調整中）
  - **🔧 グリッド表示**: 20pxグリッド表示（編集モード時）
- **コマリサイズ**: 8方向ハンドル
  - オレンジの四角（角）: 比例リサイズ
  - 緑の円（辺）: 一方向リサイズ
  - **🔧 感度調整**: 適切な操作感に調整済み
- **コマ分割**: 紫のハサミボタン（右下角）
  - 水平分割（上下）/ 垂直分割（左右）
- **🆕 コマ削除**: 複数の削除方法
  - 赤い×ボタン（左上角）
  - Delete/Backspaceキー
  - 右クリックメニュー → 🗑️ コマ削除
  - 削除確認ダイアログ + 子要素一括削除
- **🆕 右クリックメニュー拡張**: パネル操作の充実
  - **🔧 コマ編集**: 右クリックから編集モード自動ON（NEW!）
  - 水平分割 / 垂直分割
  - 🗑️ コマ削除
- **履歴対応**: コマ操作もアンドゥ/リドゥ可能

#### 🆕 パネルテンプレート自動配置（COMPLETE!）
- **6種類のテンプレート**に専用シーン自動配置
  - **4koma**: 4コマ漫画の典型的な構成（起承転結）
  - **dialogue**: 会話重視レイアウト（全体→アップ→結論）
  - **action**: アクション系ダイナミック構成
  - **emotional**: 感情表現重視の構成
  - **gag**: ギャグ・コメディのテンポ重視
  - **custom**: シンプルなカスタム用
- **自動配置要素**:
  - キャラクター（適切な位置・表情・ポーズ）
  - 吹き出し（シーンに合った種類・サイズ・配置）
  - 斜め方向機能を活用した高度な表現

#### 吹き出し機能
- 自由移動（パネル外移動可能）
- 3方向リサイズ（上下端/左右端/四隅で操作分岐）
- ダブルクリック編集
- 4種類の形状（普通/叫び/小声/心の声）
- 右クリックメニュー（編集・削除）

#### キャラクター機能
- 絶対座標での自由移動（パネル外移動可能）
- 8方向リサイズハンドル（吹き出しと同じ方式）
- 表示タイプ切り替え（顔のみ/上半身/全身）
- 4種類のキャラクター（主人公/ヒロイン/ライバル/友人）
- **8方向の顔の角度**: 正面/左/右/後ろ + 斜め4方向（leftFront/rightFront/leftBack/rightBack）
- **9方向の視線**: 中央/上下左右 + 斜め4方向（leftUp/rightUp/leftDown/rightDown）
- **サイズ制限拡張**: 最大5.0倍まで拡大可能（従来3.0倍から拡張）
- **斜め方向描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整
- **表情システム**: 8種類（ふつう/にっこり/かなしい/おこってる/びっくり/てれてる/こまった/ねむい）
- **ポーズシステム**: 6種類（立ってる/座ってる/歩いてる/指さし/手を振る/腕くみ）

#### シーンテンプレート機能
- 8種類のシーンテンプレート（基本5種類 + 斜め方向活用3種類）
  - **基本**: 日常/会話/アクション/感情/コメディ
  - **斜め方向活用**: 恋愛/緊張/驚き
- 選択パネルへの優先配置

#### 操作機能
- アンドゥ/リドゥ機能（Ctrl+Z/Ctrl+Y）
- 要素削除（Backspace/Delete）
- キーボードショートカット対応
- 右クリックコンテキストメニュー（詳細設定・編集・削除）
- **🆕 コマ編集モード切り替え（Ctrl+E）**
- **🔧 スナップ機能**: 隣接コマとの自動位置合わせ（調整中）

#### UI機能
- デフォルトダークモード
- ライト/ダークモード切り替え
- 左右サイドバーレイアウト
- **キャラクター詳細設定パネル**: 簡略化されたUI（4方向/5視線/8表情/6ポーズ）
- **🆕 コマ編集モード表示**: 編集状態の視覚的フィードバック
- **🆕 操作状態表示**: 移動中・リサイズ中・削除確認の表示
- **🆕 グリッド表示**: 編集モード時の20pxグリッド

#### ファイル構造
- 保守性向上のための構造化
- TypeScriptによる型安全性
- **🆕 コマ操作機能の分離**: PanelRenderer.tsxに集約
- **🆕 スナップ機能**: 高度な位置合わせシステム（調整中）

### 🔄 進行中・調整中

#### 🔧 スナップ・グリッド機能の調整
- **問題**: スナップ位置がリサイズハンドル（四隅の四角）に吸着してしまう
- **現象**: パネル境界ではなくハンドル位置でスナップしてズレる
- **状況**: 補助線は表示されるが、吸着位置が不正確
- **調整必要**: パネル本体の境界線でのスナップに修正が必要

#### 🔧 補助線表示の調整
- **実装済み**: 1px細線 + 0.5pxオフセットで鮮明表示
- **色設定**: 緑（ダーク）/ 赤（ライト）の破線
- **位置調整**: パネル境界に正確に合わせる必要

### 🐛 既知のバグ

#### 修正済み
- ~~吹き出し追加バグ~~: ✅ 修正完了
- ~~シーンテンプレート配置バグ~~: ✅ 修正完了
- ~~パネルリサイズ感度問題~~: ✅ 修正完了（感度調整）
- ~~右クリックメニュー表示問題~~: ✅ 修正完了

#### 🚨 現在の問題
1. **スナップ位置のズレ**: リサイズハンドル位置への誤った吸着
2. **補助線と実際の位置の不一致**: 表示される補助線と実際のスナップ位置がズレる

### 🚀 次に追加したい機能

#### 優先度：緊急（バグ修正）
1. **🔧 スナップ機能の修正**: パネル境界での正確な吸着

#### 優先度：最高（新技術導入）
1. **🤖 ChatGPT API連携システム**
   - **ストーリー企画支援**: ユーザーとChatGPTが会話しながらストーリー構築
   - **キャラクター設定生成**: 性格・背景・関係性の自動生成
   - **セリフ提案機能**: シーンに合ったセリフの自動提案
   - **構成アドバイス**: 起承転結・コマ配置のアドバイス
   - **展開案生成**: 複数の展開パターンを自動生成
   - **設定管理**: 作品全体の設定・キャラ情報の一元管理

2. **🎮 3Dキャラクター表示システム**
   - **Three.js統合**: 3D表示エンジンの導入
   - **3Dキャラモデル**: アバター風の可愛らしい3Dキャラクター
   - **表情・ポーズの3D表現**: 既存の8表情・6ポーズを3Dで表現
   - **角度・視線の3D対応**: 8方向角度・9方向視線を3D空間で表現
   - **リアルタイムプレビュー**: 設定変更時の3Dモデル即座更新
   - **2D/3D切り替え**: 従来の2D表示との切り替え機能
   - **カメラ操作**: 3Dモデルの回転・ズーム・パン操作
   - **ライティング**: 3Dモデルの見栄えを良くする照明システム

3. **📝 プロンプト生成システム**
   - **キャラ情報のプロンプト化**: 表情・ポーズ・角度・視線を文章化
   - **シーン情報のプロンプト化**: コマ構成・背景・状況を文章化
   - **カスタムプロンプトメーカー連携**: 既存のプロンプトメーカーとの連携
   - **エクスポート機能**: 生成したプロンプトのコピー・保存
   - **テンプレート機能**: よく使うプロンプトパターンの保存
   - **バッチ生成**: 複数コマのプロンプトを一括生成

#### 優先度：高（従来機能拡張）
1. **エクスポート機能**: PDF、PNG、クリスタ用データ出力
2. **コマ結合機能**: 分割したコマを結合する機能
3. **コマ複製機能**: 既存のコマをコピー&ペースト

#### 優先度：中（機能充実）
1. **スナップ設定UI**: グリッドサイズ・感度のユーザー設定
2. **表情・ポーズのプリセット保存**: ユーザー独自の組み合わせ保存
3. **背景・小物システム**: シンプルな背景要素の追加
4. **セリフフォント設定**: 縦書き/横書き、フォントサイズの詳細設定

#### 優先度：低（最適化・改善）
1. **パフォーマンス最適化**: 大量要素での描画最適化
2. **レスポンシブ対応**: モバイル端末での操作性向上
3. **クラウド保存機能**: 作品のオンライン保存・共有

### 🆕 新技術導入計画

#### 🤖 ChatGPT API連携の詳細設計

**実装方針**:
- OpenAI API Key設定画面
- 会話履歴管理システム
- APIレスポンスの構造化
- エラーハンドリング・レート制限対応

**主要機能**:
1. **ストーリー企画チャット**
   - ユーザー ↔ ChatGPT の対話形式
   - 企画内容の段階的詳細化
   - キーポイントの自動抽出・保存

2. **キャラクター生成アシスタント**
   - 基本設定（名前・年齢・性格）の生成
   - 見た目・特徴の詳細設定
   - 他キャラとの関係性設定

3. **セリフ・展開提案**
   - 現在のシーン状況を解析
   - 適切なセリフ候補を複数提案
   - 次の展開パターンを提案

**技術実装**:
```typescript
interface ChatGPTIntegration {
  apiKey: string;
  conversationHistory: ChatMessage[];
  storyContext: StoryContext;
  characterProfiles: CharacterProfile[];
}

interface StoryContext {
  genre: string;
  theme: string;
  targetAudience: string;
  currentScene: string;
  plotPoints: PlotPoint[];
}
```

#### 🎮 3D表示システムの詳細設計

**実装方針**:
- Three.js + React Fiber統合
- 低ポリゴン・アニメ調3Dモデル
- 軽量・高速な描画システム
- 既存2D機能との互換性維持

**3Dモデル仕様**:
1. **基本モデル**
   - アバター風の可愛いキャラクター
   - 顔・髪・体の分離構造
   - モーフィング対応の表情システム

2. **表情システム（3D対応）**
   - 既存8表情のモーフターゲット
   - 目・口・眉の独立制御
   - 自然な表情遷移アニメーション

3. **ポーズシステム（3D対応）**
   - 6ポーズのボーン・アニメーション
   - IK（Inverse Kinematics）による自然な動き
   - ブレンド可能なポーズシステム

**技術実装**:
```typescript
interface Character3D {
  model: THREE.Group;
  expressions: ExpressionMorph[];
  poses: PoseAnimation[];
  materials: CharacterMaterials;
  animations: AnimationClip[];
}

interface ExpressionMorph {
  name: string;
  weight: number; // 0-1
  morphTargets: THREE.Mesh[];
}
```

#### 📝 プロンプト生成システムの詳細設計

**実装方針**:
- 現在のキャラ状態を自然言語化
- カスタマイズ可能なテンプレート
- 既存プロンプトメーカーとの連携
- バッチ処理・一括出力対応

**プロンプト生成内容**:
1. **キャラクター記述**
   ```
   "可愛い女の子、茶色いロングヘア、にっこり笑顔、右を向いて、
   立ちポーズ、上半身、明るい表情"
   ```

2. **シーン記述**
   ```
   "学校の教室、窓際の席、午後の自然光、
   会話シーン、2人のキャラクターが向かい合って"
   ```

3. **コマ構成記述**
   ```
   "4コマ漫画、起承転結の構成、1コマ目：日常場面、
   2コマ目：問題発生、3コマ目：解決行動、4コマ目：結論"
   ```

**技術実装**:
```typescript
interface PromptGenerator {
  characterToPrompt(character: Character): string;
  sceneToPrompt(scene: Scene): string;
  panelToPrompt(panel: Panel): string;
  exportBatch(panels: Panel[]): PromptExport[];
}

interface PromptExport {
  panelIndex: number;
  characterPrompts: string[];
  scenePrompt: string;
  compositionPrompt: string;
}
```

### ❌ 未実装・将来予定
1. **アニメーション機能**: 簡単な動きの表現
2. **コラボレーション機能**: 複数人での共同編集
3. **VR/AR対応**: 没入型ネーム制作環境
4. **AI音声生成**: キャラクターの声の生成
5. **動画出力**: アニメーション付きネームの動画化

## 拡張ファイル構造（将来版）
```
src/
├── types.ts                    # 共通型定義（AI・3D・プロンプト対応）
├── App.tsx                     # メインアプリ（3Dビュー・AIチャット統合）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（2D/3D切り替え対応）
│   ├── 3D/                     # 🆕 3D表示システム
│   │   ├── Character3DViewer.tsx    # 3Dキャラクター表示
│   │   ├── Scene3DManager.tsx       # 3Dシーン管理
│   │   ├── models/                  # 3Dモデル・アニメーション
│   │   └── shaders/                 # カスタムシェーダー
│   ├── AI/                     # 🆕 AI統合システム
│   │   ├── ChatGPTPanel.tsx         # ChatGPT会話パネル
│   │   ├── StoryAssistant.tsx       # ストーリー企画支援
│   │   ├── CharacterGenerator.tsx   # キャラ生成AI
│   │   └── DialogueSuggester.tsx    # セリフ提案AI
│   ├── Prompt/                 # 🆕 プロンプト生成システム
│   │   ├── PromptGenerator.tsx      # プロンプト生成
│   │   ├── PromptExporter.tsx       # エクスポート機能
│   │   ├── TemplateManager.tsx      # テンプレート管理
│   │   └── BatchProcessor.tsx       # バッチ処理
│   ├── UI/
│   │   ├── CharacterDetailPanel.tsx # キャラクター詳細設定（3D対応）
│   │   ├── AIControlPanel.tsx       # 🆕 AI制御パネル
│   │   ├── 3DControlPanel.tsx       # 🆕 3D制御パネル
│   │   └── PromptPanel.tsx          # 🆕 プロンプト生成パネル
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx      # 編集モーダル（AI提案統合）
│       ├── templates.ts             # パネルテンプレート定義
│       ├── sceneTemplates.ts        # シーンテンプレート定義
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（2D/3D統合）
│           └── PanelRenderer.tsx     # パネル描画・操作
├── services/                   # 🆕 外部サービス連携
│   ├── openai.ts              # OpenAI API統合
│   ├── promptMaker.ts         # プロンプトメーカー連携
│   └── export.ts              # エクスポート機能
├── utils/                     # 🆕 ユーティリティ
│   ├── promptTemplates.ts     # プロンプトテンプレート
│   ├── 3dHelpers.ts          # 3D関連ヘルパー
│   └── aiHelpers.ts          # AI関連ヘルパー
└── assets/                    # 🆕 3Dアセット
    ├── models/                # 3Dモデルファイル
    ├── textures/              # テクスチャ
    └── animations/            # アニメーションデータ
```

## 重要な技術詳細（拡張版）

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標（新規）+ 相対座標（既存・互換性）
- **パネル**: 絶対座標
- **🆕 3Dキャラクター**: 3D空間座標 ↔ 2D画面座標の変換

### 🆕 AI統合システム
- **ChatGPT API**: ストーリー企画・キャラ生成・セリフ提案
- **コンテキスト管理**: 作品全体の設定・進行状況を維持
- **プロンプトエンジニアリング**: 最適な応答を得るためのプロンプト設計
- **レート制限対応**: API制限を考慮したリクエスト管理

### 🆕 3D描画システム
- **Three.js統合**: React Three Fiberによる宣言的3D描画
- **パフォーマンス最適化**: LOD・カリング・メモ化による高速化
- **2D/3D混在**: 同一シーンでの2Dと3Dの組み合わせ
- **アニメーション**: スムーズな表情・ポーズ遷移

### 🆕 プロンプト生成エンジン
- **テンプレートシステム**: カスタマイズ可能なプロンプト形式
- **自然言語処理**: キャラ状態の適切な文章化
- **バッチ処理**: 複数コマの一括プロンプト生成
- **外部連携**: 既存プロンプトメーカーとのデータ交換

### 🔧 コマ操作システム（完全実装）
- **移動**: 中央の青い円形ハンドル + スナップ機能
- **リサイズ**: 8方向ハンドル（角＝比例、辺＝一方向）+ 感度調整
- **分割**: 右下角のハサミボタン
- **削除**: 左上角×ボタン + キーボード + 右クリック
- **最小サイズ制限**: 50px（操作性を考慮）
- **履歴対応**: すべてのコマ操作がアンドゥ/リドゥ可能

### 🔧 スナップシステム（調整中）
- **6種類のスナップ**: 左端・右端・中央（水平）、上端・下端・中央（垂直）
- **補助線表示**: リアルタイム破線ガイド（1px細線）
- **感度調整**: 12px以内で自動吸着
- **グリッドスナップ**: 20pxグリッドも対応
- **視覚的フィードバック**: ダークモード対応カラー
- **🚨 調整必要**: パネル境界での正確なスナップ

### 🆕 グリッドシステム
- **20px間隔グリッド**: 編集モード時のみ表示
- **薄いグレー**: 邪魔にならない透明度
- **ダークモード対応**: テーマに応じた色調整

### 🆕 自動配置システム
- **テンプレート選択時**: パネル+キャラ+吹き出し を一括配置
- **シーン特化**: 各テンプレートに最適な構成を事前定義
- **座標計算**: 絶対座標での精密配置
- **ID管理**: 重複しない一意ID生成

### 操作方式（改善済み）
- **吹き出しリサイズ**: 領域ベース判定（上下端/左右端/四隅/中央）
- **キャラクターリサイズ**: 領域ベース判定（吹き出しと同じ方式）
- **🆕 パネルリサイズ**: ハンドルベース判定（8方向）+ 感度調整
- **移動**: ドラッグ&ドロップ（パネル外移動可能）+ スナップ機能（調整中）

### キャラクター表現システム（完全実装済み + 3D拡張予定）
- **顔の角度**: 8方向対応（front, left, right, back, leftFront, rightFront, leftBack, rightBack）
- **視線方向**: 9方向対応（center, left, right, up, down, leftUp, rightUp, leftDown, rightDown）
- **描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整、後ろ向き系の髪のみ表示
- **UI**: 簡略化された直感的なボタンUI
- **🆕 3D対応**: 3Dモデルでの表情・ポーズ・角度・視線の表現

### 🆕 右クリックメニューシステム
- **パネル右クリック**: 編集モード外でも表示
- **🔧 コマ編集**: 右クリックから編集モード自動ON + パネル選択
- **分割・削除**: 確認ダイアログ付き安全操作
- **コールバック連携**: 親コンポーネントとの編集モード同期

### 状態管理（拡張予定）
- React useState でローカル管理
- 親子間コールバック方式
- **🆕 拡張履歴管理**: キャラ+吹き出し+パネル の3要素対応
- アンドゥ/リドゥ用操作履歴管理（50操作まで）
- **🆕 スナップライン管理**: リアルタイム補助線表示
- **🆕 グリッド表示管理**: 編集モード連動の表示制御
- **🆕 AI状態管理**: ChatGPT会話履歴・生成データ管理
- **🆕 3D状態管理**: 3Dシーン・カメラ・ライティング管理
- **🆕 プロンプト状態管理**: 生成履歴・テンプレート・エクスポート設定

## 起動方法（拡張対応）
```bash
# 基本起動
npm start

# 🆕 環境変数設定（APIキー等）
cp .env.example .env
# OPENAI_API_KEY=your_api_key_here を設定

# 🆕 3Dモデル・アセットの準備
npm run setup-assets

# http://localhost:3000 でアクセス
```

## 🆕 最新機能の使い方（拡張版）

### コマ操作機能
1. **編集モード切り替え**: 右上の🔧ボタンまたは`Ctrl+E`
2. **コマ選択**: 編集モード時にコマをクリック
3. **移動**: 中央の青い円をドラッグ
   - **自動スナップ**: 他のコマに近づくと自動位置合わせ（調整中）
   - **補助線表示**: 移動中に破線ガイド表示
   - **グリッド表示**: 20pxグリッドが背景に表示
4. **リサイズ**: 
   - オレンジの四角（角）: 比例リサイズ
   - 緑の円（辺）: 一方向リサイズ
   - **感度調整済み**: 適切な操作感
5. **分割**: 右下の紫ハサミボタン → 水平/垂直選択
6. **削除**: 
   - 左上の赤×ボタン
   - Delete/Backspaceキー
   - 右クリック → 🗑️ コマ削除

### 🆕 ChatGPT AI連携機能（予定）
1. **ストーリー企画チャット**:
   - 右サイドバーのAIアシスタントパネルを開く
   - 「どんな話にしたいですか？」から会話開始
   - ChatGPTと対話しながら設定・キャラ・プロットを決定
   - 決定した内容が自動でネームに反映

2. **キャラクター自動生成**:
   - 「新しいキャラを作って」でAI生成開始
   - 性格・見た目・背景をChatGPTが提案
   - 気に入った設定をワンクリックで採用
   - 3Dモデルに自動反映

3. **セリフ提案機能**:
   - 吹き出しを右クリック → 「AIにセリフ提案してもらう」
   - 現在のシーン状況をAIが分析
   - 複数のセリフ候補を提案
   - 選択したセリフが自動入力

### 🆕 3Dキャラクター表示機能（予定）
1. **3D/2D切り替え**:
   - キャラクター詳細パネルに「3D表示」ボタン
   - リアルタイムで2D ↔ 3D表示切り替え
   - 3Dモードでは360度回転・ズーム可能

2. **3D表情・ポーズ設定**:
   - 従来の8表情・6ポーズが3Dで表現される
   - より直感的な表情・ポーズの確認
   - アニメーション付きの滑らかな変化

3. **3Dカメラ操作**:
   - マウスドラッグで回転
   - ホイールでズーム
   - 右クリック+ドラッグでパン
   - 「正面に戻す」ボタンでリセット

### 🆕 プロンプト生成機能（予定）
1. **キャラプロンプト生成**:
   - キャラクターを右クリック → 「プロンプト生成」
   - 現在の表情・ポーズ・角度が文章化される
   - 「可愛い女の子、茶色いロングヘア、にっこり笑顔、右向き、立ちポーズ」

2. **シーンプロンプト生成**:
   - パネルを右クリック → 「シーンプロンプト生成」
   - コマ全体の構成・雰囲気が文章化される
   - 背景・ライティング・カメラアングルの情報も含む

3. **一括プロンプト出力**:
   - 「全コマのプロンプト生成」ボタン
   - 全てのコマのプロンプトを一括生成
   - CSV・JSON・テキスト形式で出力
   - 既存のプロンプトメーカーに直接コピペ可能

### 🆕 右クリックからのコマ編集
1. **コマ右クリック**: 編集モード外でも可能
2. **🔧 コマ編集選択**: 編集モード自動ON + そのコマが選択状態
3. **即座に編集開始**: ワンクリックで編集モードに移行

### パネルテンプレート自動配置
1. **左サイドバー**: パネルテンプレートを選択
2. **自動配置**: キャラクターと吹き出しが自動で配置される
3. **カスタマイズ**: 追加でシーンテンプレートやキャラクターを配置可能
4. **🆕 AI連携**: ChatGPTの提案に基づいた自動配置も可能

## 次回開発時の優先事項（拡張版）

### 🚨 緊急度：最高（バグ修正）
1. **スナップ位置の修正**
   - パネル境界での正確な吸着に修正
   - リサイズハンドル位置への誤った吸着を解消
   - 補助線と実際のスナップ位置の一致

### 🤖 緊急度：最高（AI機能導入）
1. **ChatGPT API統合**
   - OpenAI APIキー設定画面
   - 基本的な会話システム
   - ストーリー企画アシスタント機能
   - エラーハンドリング・レート制限対応

2. **AI-人間協調インターフェース**
   - ChatGPT提案の採用/却下システム
   - 段階的な設定確定フロー
   - 会話履歴とネーム制作の連動

### 🎮 緊急度：最高（3D機能導入）
1. **Three.js基盤構築**
   - React Three Fiberの統合
   - 基本的な3Dシーン構築
   - 2D/3D表示切り替えシステム

2. **3Dキャラクターモデル**
   - シンプルなアバター風3Dモデル
   - 基本的な表情モーフィング
   - ボーンアニメーションシステム

### 📝 緊急度：最高（プロンプト機能導入）
1. **プロンプト生成エンジン**
   - キャラ状態の自然言語化
   - カスタマイズ可能なテンプレート
   - バッチ処理システム

2. **外部連携システム**
   - プロンプトメーカーとの連携
   - エクスポート機能（CSV/JSON/TXT）
   - コピー&ペースト機能

### 🔥 緊急度：高（従来機能拡張）
1. **エクスポート機能実装**
   - PDF出力（ネーム用）
   - PNG画像出力
   - クリスタ用データ出力

2. **コマ結合機能**
   - 隣接するコマの結合
   - 分割の逆操作

### 📈 重要度：中（機能拡張）
1. **コマ複製機能**
   - Ctrl+C/Ctrl+V でのコピー&ペースト
   - 別パネルへの複製

2. **スナップ設定UI**
   - グリッドサイズの調整
   - スナップ感度の設定
   - スナップON/OFF切り替え

3. **背景・小物システム**
   - シンプルな背景要素
   - 効果線・集中線

### 🎨 重要度：低（UI改善・最適化）
1. **パフォーマンス最適化**
   - 3D描画の最適化
   - AI API呼び出しの効率化
   - メモリ使用量の最適化

2. **ヘルプ・チュートリアル機能**
   - AI機能の使い方ガイド
   - 3D操作の説明
   - プロンプト生成のコツ

## ✅ 今回の作業内容（2025-09-09 Part 2）

### 🆕 新規実装機能
1. **コマ右クリック編集機能**
   - 右クリック → 🔧 コマ編集で編集モード自動ON
   - パネル選択状態の自動設定
   - App.tsx ↔ CanvasComponent.tsx のコールバック連携

2. **グリッド表示システム**
   - 20px間隔のグリッド線表示
   - 編集モード時のみ表示
   - ダークモード対応色調整

3. **スナップ機能の実装**
   - 6種類の自動位置合わせ
   - リアルタイム補助線表示
   - 1px細線 + 0.5pxオフセットで鮮明表示

### 🔧 技術的改善
- **types.ts**: `onPanelEditModeToggle`コールバック追加
- **App.tsx**: 編集モード切り替えコールバック実装
- **CanvasComponent.tsx**: 右クリック編集・グリッド・スナップ統合
- **PanelRenderer.tsx**: グリッド描画・スナップ機能実装

### 🆕 拡張計画策定
- **AI連携**: ChatGPT API統合によるストーリー企画支援
- **3D表示**: Three.jsによる3Dキャラクター表示
- **プロンプト生成**: 既存プロンプトメーカーとの連携

### 🚨 発見された問題
1. **スナップ位置のズレ**: リサイズハンドル座標への誤った吸着
2. **補助線位置の不一致**: 表示される補助線と実際のスナップ位置のズレ

### 🎯 ユーザビリティ向上
- **右クリックからの編集開始**: ワンクリックで編集モード移行
- **視覚的ガイド**: グリッド表示で位置合わせが容易
- **リアルタイム補助線**: 移動中の位置確認が可能

## よくある問題と解決法（拡張版）
- **コマ操作が効かない**: 編集モード（🔧）がONになっているか確認
- **ハンドルが表示されない**: コマを選択してから編集モードをON
- **右クリックメニューが出ない**: パネル部分を確実にクリックしているか確認
- **🔧 コマ編集が出ない**: パネル部分を右クリックしているか確認（編集モード外でもOK）
- **自動配置されない**: テンプレートをクリックしているか確認
- **分割ができない**: パネルが選択されているか、最小サイズに達していないか確認
- **スナップがズレる**: 現在調整中（パネル境界ではなくハンドル位置に吸着する問題）
- **グリッドが表示されない**: 編集モードがONになっているか確認
- **🆕 AI機能が使えない**: OpenAI APIキーが設定されているか確認
- **🆕 3D表示されない**: ブラウザがWebGLに対応しているか確認
- **🆕 プロンプト生成できない**: キャラクターの設定が完了しているか確認

## 技術要件（拡張版）

### 必要なライブラリ追加
```bash
# AI統合
npm install openai
npm install @types/openai

# 3D表示
npm install three @react-three/fiber @react-three/drei
npm install @types/three

# プロンプト処理
npm install papaparse csv-writer
npm install @types/papaparse

# 状態管理拡張
npm install zustand immer

# UI拡張
npm install react-split-pane react-resizable
```

### 環境設定
```bash
# .env ファイル
REACT_APP_OPENAI_API_KEY=your_openai_api_key
REACT_APP_PROMPT_MAKER_URL=your_prompt_maker_url
REACT_APP_3D_ASSETS_BASE_URL=/assets/3d/
```

## 開発フロー（拡張版）
1. **バグ修正** → **AI機能** → **3D機能** → **プロンプト機能** → **統合テスト** → **UI改善** → **ドキュメント更新** の順で進める
2. **段階的導入**を重視し、既存機能を壊さずに新機能を追加
3. **ユーザーテスト**を各段階で実施し、使いやすさを検証
4. **パフォーマンス**と**使いやすさ**のバランスを重視
5. **AI・3D・プロンプト**の3つの新技術を順次統合

## クイックスタート（新しいClaude向け・拡張版）
このファイルを提示して「この拡張計画から開発を続けてください」と言えば、現在の実装状況と将来の拡張計画を把握して開発を継続できます。

**現在の状況**:
- ✅ 基本機能完成済み
- ✅ 座標系統一・UI改善完了
- ✅ キャラクター斜め方向機能完全実装済み
- ✅ **コマ操作機能完全実装済み**（移動・リサイズ・分割・削除）
- ✅ **パネルテンプレート自動配置完全実装済み**
- ✅ **右クリック編集機能完全実装済み**（NEW!）
- ✅ **グリッド表示システム完全実装済み**（NEW!）
- 🔧 **スナップ機能調整中**（吸着位置の修正が必要）

**次の大目標（3つの新技術導入）**: 
1. **🚨 スナップ位置の修正**（最優先・バグ修正）
2. **🤖 ChatGPT API連携**（ストーリー企画・キャラ生成・セリフ提案）
3. **🎮 3Dキャラクター表示**（Three.js・表情・ポーズ・アニメーション）
4. **📝 プロンプト生成システム**（自然言語化・外部連携・バッチ出力）

## 開発コマンド（拡張版）
```bash
# 開発サーバー起動
npm start

# 新しいライブラリのインストール
npm install openai three @react-three/fiber @react-three/drei

# 型チェック
npx tsc --noEmit

# 3Dアセットの準備
npm run setup-3d-assets

# AIテスト（APIキー必要）
npm run test-ai-integration

# ビルド（本番用）
npm run build

# Git保存
git add .
git commit -m "拡張計画策定: ChatGPT API・3D表示・プロンプト生成システム（スナップ機能調整中）"
git push origin main
```

## 🎉 プロジェクト達成状況（拡張版）

### Phase 1: 基本機能 ✅
- Canvas描画、キャラクター・吹き出し操作、テンプレート機能

### Phase 2: 高度な表現 ✅  
- 斜め方向、表情・ポーズシステム、シーンテンプレート

### Phase 3: コマ操作・自動化 ✅
- コマの移動・リサイズ・分割、パネルテンプレート自動配置

### Phase 4: コマ管理・UX向上 ✅
- コマ削除、右クリック拡張、感度調整

### Phase 5: グリッド・スナップ機能 🔧 **← 現在調整中！**
- グリッド表示、右クリック編集、スナップ機能（パネル境界スナップ調整中）

### 🆕 Phase 6: AI統合システム 🚀 **← 次の大目標！**
- ChatGPT API連携、ストーリー企画支援、キャラクター自動生成、セリフ提案

### 🆕 Phase 7: 3D表示システム 🚀 **← 次の大目標！**
- Three.js統合、3Dキャラクターモデル、表情・ポーズアニメーション、カメラ操作

### 🆕 Phase 8: プロンプト生成システム 🚀 **← 次の大目標！**
- 自動プロンプト化、プロンプトメーカー連携、バッチ出力、テンプレートシステム

### Phase 9: エクスポート・最終仕上げ 🔜
- PDF/PNG出力、コマ結合・複製、背景システム、パフォーマンス最適化

**現在の進捗率: 65% 完了** 🚀  
**拡張後の最終進捗率: 40% 完了**（新機能大幅追加により分母が拡大）

---

## 🎯 開発ロードマップ（拡張版）

### 短期目標（1-2週間）
1. ✅ スナップ機能のバグ修正
2. 🤖 ChatGPT API基本統合
3. 🎮 Three.js基盤構築
4. 📝 プロンプト生成エンジン基本版

### 中期目標（1-2ヶ月）
1. 🤖 ストーリー企画アシスタント完成
2. 🎮 3Dキャラクター表示完成
3. 📝 プロンプトメーカー連携完成
4. 🔄 AI・3D・プロンプト機能の統合

### 長期目標（2-3ヶ月）
1. 🎨 高度なUI/UX改善
2. ⚡ パフォーマンス最適化
3. 📚 チュートリアル・ヘルプ完成
4. 🌐 クラウド機能・共有システム

**この拡張プロジェクトにより、単なるネーム制作ツールから「AI・3D・プロンプト連携による次世代クリエイティブツール」へと進化します！** 🚀✨