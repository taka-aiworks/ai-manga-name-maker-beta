# ネーム制作ツール - プロジェクト状況ファイル

# ネーム制作ツール - プロジェクト状況ファイル

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月9日（コマ移動・削除・スナップ・グリッド機能開発中）

## 現在の実装状況

### ✅ 完了機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### 🆕 コマ操作機能（COMPLETE!）
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
  - **🔧 スナップ機能**: 隣接コマとの自動位置合わせ（調整中）
  - **🔧 補助線表示**: 移動中に破線ガイド表示（調整中）
  - **🔧 グリッド表示**: 20pxグリッド表示（編集モード時）
- **コマリサイズ**: 8方向ハンドル
  - オレンジの四角（角）: 比例リサイズ
  - 緑の円（辺）: 一方向リサイズ
  - **🔧 感度調整**: 適切な操作感に調整済み
- **コマ分割**: 紫のハサミボタン（右下角）
  - 水平分割（上下）/ 垂直分割（左右）
- **🆕 コマ削除**: 複数の削除方法
  - 赤い×ボタン（左上角）
  - Delete/Backspaceキー
  - 右クリックメニュー → 🗑️ コマ削除
  - 削除確認ダイアログ + 子要素一括削除
- **🆕 右クリックメニュー拡張**: パネル操作の充実
  - **🔧 コマ編集**: 右クリックから編集モード自動ON（NEW!）
  - 水平分割 / 垂直分割
  - 🗑️ コマ削除
- **履歴対応**: コマ操作もアンドゥ/リドゥ可能

#### 🆕 パネルテンプレート自動配置（COMPLETE!）
- **6種類のテンプレート**に専用シーン自動配置
  - **4koma**: 4コマ漫画の典型的な構成（起承転結）
  - **dialogue**: 会話重視レイアウト（全体→アップ→結論）
  - **action**: アクション系ダイナミック構成
  - **emotional**: 感情表現重視の構成
  - **gag**: ギャグ・コメディのテンポ重視
  - **custom**: シンプルなカスタム用
- **自動配置要素**:
  - キャラクター（適切な位置・表情・ポーズ）
  - 吹き出し（シーンに合った種類・サイズ・配置）
  - 斜め方向機能を活用した高度な表現

#### 吹き出し機能
- 自由移動（パネル外移動可能）
- 3方向リサイズ（上下端/左右端/四隅で操作分岐）
- ダブルクリック編集
- 4種類の形状（普通/叫び/小声/心の声）
- 右クリックメニュー（編集・削除）

#### キャラクター機能
- 絶対座標での自由移動（パネル外移動可能）
- 8方向リサイズハンドル（吹き出しと同じ方式）
- 表示タイプ切り替え（顔のみ/上半身/全身）
- 4種類のキャラクター（主人公/ヒロイン/ライバル/友人）
- **8方向の顔の角度**: 正面/左/右/後ろ + 斜め4方向（leftFront/rightFront/leftBack/rightBack）
- **9方向の視線**: 中央/上下左右 + 斜め4方向（leftUp/rightUp/leftDown/rightDown）
- **サイズ制限拡張**: 最大5.0倍まで拡大可能（従来3.0倍から拡張）
- **斜め方向描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整
- **表情システム**: 8種類（ふつう/にっこり/かなしい/おこってる/びっくり/てれてる/こまった/ねむい）
- **ポーズシステム**: 6種類（立ってる/座ってる/歩いてる/指さし/手を振る/腕くみ）

#### シーンテンプレート機能
- 8種類のシーンテンプレート（基本5種類 + 斜め方向活用3種類）
  - **基本**: 日常/会話/アクション/感情/コメディ
  - **斜め方向活用**: 恋愛/緊張/驚き
- 選択パネルへの優先配置

#### 操作機能
- アンドゥ/リドゥ機能（Ctrl+Z/Ctrl+Y）
- 要素削除（Backspace/Delete）
- キーボードショートカット対応
- 右クリックコンテキストメニュー（詳細設定・編集・削除）
- **🆕 コマ編集モード切り替え（Ctrl+E）**
- **🔧 スナップ機能**: 隣接コマとの自動位置合わせ（調整中）

#### UI機能
- デフォルトダークモード
- ライト/ダークモード切り替え
- 左右サイドバーレイアウト
- **キャラクター詳細設定パネル**: 簡略化されたUI（4方向/5視線/8表情/6ポーズ）
- **🆕 コマ編集モード表示**: 編集状態の視覚的フィードバック
- **🆕 操作状態表示**: 移動中・リサイズ中・削除確認の表示
- **🆕 グリッド表示**: 編集モード時の20pxグリッド

#### ファイル構造
- 保守性向上のための構造化
- TypeScriptによる型安全性
- **🆕 コマ操作機能の分離**: PanelRenderer.tsxに集約
- **🆕 スナップ機能**: 高度な位置合わせシステム（調整中）

### 🔄 進行中・調整中

#### 🔧 スナップ・グリッド機能の調整
- **問題**: スナップ位置がリサイズハンドル（四隅の四角）に吸着してしまう
- **現象**: パネル境界ではなくハンドル位置でスナップしてズレる
- **状況**: 補助線は表示されるが、吸着位置が不正確
- **調整必要**: パネル本体の境界線でのスナップに修正が必要

#### 🔧 補助線表示の調整
- **実装済み**: 1px細線 + 0.5pxオフセットで鮮明表示
- **色設定**: 緑（ダーク）/ 赤（ライト）の破線
- **位置調整**: パネル境界に正確に合わせる必要

### 🐛 既知のバグ

#### 修正済み
- ~~吹き出し追加バグ~~: ✅ 修正完了
- ~~シーンテンプレート配置バグ~~: ✅ 修正完了
- ~~パネルリサイズ感度問題~~: ✅ 修正完了（感度調整）
- ~~右クリックメニュー表示問題~~: ✅ 修正完了

#### 🚨 現在の問題
1. **スナップ位置のズレ**: リサイズハンドル位置への誤った吸着
2. **補助線と実際の位置の不一致**: 表示される補助線と実際のスナップ位置がズレる

### 🚀 次に追加したい機能

#### 優先度：高
1. **🔧 スナップ機能の修正**: パネル境界での正確な吸着
2. **エクスポート機能**: PDF、PNG、クリスタ用データ出力
3. **コマ結合機能**: 分割したコマを結合する機能
4. **コマ複製機能**: 既存のコマをコピー&ペースト

#### 優先度：中
1. **スナップ設定UI**: グリッドサイズ・感度のユーザー設定
2. **表情・ポーズのプリセット保存**: ユーザー独自の組み合わせ保存
3. **背景・小物システム**: シンプルな背景要素の追加
4. **セリフフォント設定**: 縦書き/横書き、フォントサイズの詳細設定

#### 優先度：低
1. **パフォーマンス最適化**: 大量要素での描画最適化
2. **レスポンシブ対応**: モバイル端末での操作性向上
3. **クラウド保存機能**: 作品のオンライン保存・共有

### ❌ 未実装・将来予定
1. **アニメーション機能**: 簡単な動きの表現
2. **コラボレーション機能**: 複数人での共同編集
3. **AI支援機能**: セリフ提案、構成アドバイス

## ファイル構造（最新版）
```
src/
├── types.ts                    # 共通型定義（コマ操作・スナップ対応）
├── App.tsx                     # メインアプリ（編集モード切り替え対応）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（スナップ・グリッド・右クリック完全対応）
│   ├── UI/
│   │   └── CharacterDetailPanel.tsx # キャラクター詳細設定（簡略化UI完了）
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx # 編集モーダル
│       ├── templates.ts        # パネルテンプレート定義（自動配置対応完了）
│       ├── sceneTemplates.ts   # シーンテンプレート定義（斜め方向活用完了）
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（斜め方向完全対応）
│           └── PanelRenderer.tsx     # パネル描画・操作（🔧 スナップ機能調整中）
```

## 重要な技術詳細

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標（新規）+ 相対座標（既存・互換性）
- **パネル**: 絶対座標

### 🔧 コマ操作システム（調整中）
- **移動**: 中央の青い円形ハンドル + スナップ機能（調整中）
- **リサイズ**: 8方向ハンドル（角＝比例、辺＝一方向）+ 感度調整
- **分割**: 右下角のハサミボタン
- **削除**: 左上角×ボタン + キーボード + 右クリック
- **最小サイズ制限**: 50px（操作性を考慮）
- **履歴対応**: すべてのコマ操作がアンドゥ/リドゥ可能

### 🔧 スナップシステム（調整中）
- **6種類のスナップ**: 左端・右端・中央（水平）、上端・下端・中央（垂直）
- **補助線表示**: リアルタイム破線ガイド（1px細線）
- **感度調整**: 12px以内で自動吸着
- **グリッドスナップ**: 20pxグリッドも対応
- **視覚的フィードバック**: ダークモード対応カラー
- **🚨 調整必要**: パネル境界での正確なスナップ

### 🆕 グリッドシステム
- **20px間隔グリッド**: 編集モード時のみ表示
- **薄いグレー**: 邪魔にならない透明度
- **ダークモード対応**: テーマに応じた色調整

### 🆕 自動配置システム
- **テンプレート選択時**: パネル+キャラ+吹き出し を一括配置
- **シーン特化**: 各テンプレートに最適な構成を事前定義
- **座標計算**: 絶対座標での精密配置
- **ID管理**: 重複しない一意ID生成

### 操作方式（改善済み）
- **吹き出しリサイズ**: 領域ベース判定（上下端/左右端/四隅/中央）
- **キャラクターリサイズ**: 領域ベース判定（吹き出しと同じ方式）
- **🆕 パネルリサイズ**: ハンドルベース判定（8方向）+ 感度調整
- **移動**: ドラッグ&ドロップ（パネル外移動可能）+ スナップ機能（調整中）

### キャラクター表現システム（完全実装済み）
- **顔の角度**: 8方向対応（front, left, right, back, leftFront, rightFront, leftBack, rightBack）
- **視線方向**: 9方向対応（center, left, right, up, down, leftUp, rightUp, leftDown, rightDown）
- **描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整、後ろ向き系の髪のみ表示
- **UI**: 簡略化された直感的なボタンUI

### 🆕 右クリックメニューシステム
- **パネル右クリック**: 編集モード外でも表示
- **🔧 コマ編集**: 右クリックから編集モード自動ON + パネル選択
- **分割・削除**: 確認ダイアログ付き安全操作
- **コールバック連携**: 親コンポーネントとの編集モード同期

### 状態管理
- React useState でローカル管理
- 親子間コールバック方式
- **🆕 拡張履歴管理**: キャラ+吹き出し+パネル の3要素対応
- アンドゥ/リドゥ用操作履歴管理（50操作まで）
- **🆕 スナップライン管理**: リアルタイム補助線表示
- **🆕 グリッド表示管理**: 編集モード連動の表示制御

## 起動方法
```bash
npm start
# http://localhost:3000 でアクセス
```

## 🆕 最新機能の使い方（更新版）

### コマ操作機能
1. **編集モード切り替え**: 右上の🔧ボタンまたは`Ctrl+E`
2. **コマ選択**: 編集モード時にコマをクリック
3. **移動**: 中央の青い円をドラッグ
   - **自動スナップ**: 他のコマに近づくと自動位置合わせ（調整中）
   - **補助線表示**: 移動中に破線ガイド表示
   - **グリッド表示**: 20pxグリッドが背景に表示
4. **リサイズ**: 
   - オレンジの四角（角）: 比例リサイズ
   - 緑の円（辺）: 一方向リサイズ
   - **感度調整済み**: 適切な操作感
5. **分割**: 右下の紫ハサミボタン → 水平/垂直選択
6. **削除**: 
   - 左上の赤×ボタン
   - Delete/Backspaceキー
   - 右クリック → 🗑️ コマ削除

### 🆕 右クリックからのコマ編集
1. **コマ右クリック**: 編集モード外でも可能
2. **🔧 コマ編集選択**: 編集モード自動ON + そのコマが選択状態
3. **即座に編集開始**: ワンクリックで編集モードに移行

### パネルテンプレート自動配置
1. **左サイドバー**: パネルテンプレートを選択
2. **自動配置**: キャラクターと吹き出しが自動で配置される
3. **カスタマイズ**: 追加でシーンテンプレートやキャラクターを配置可能

## 次回開発時の優先事項

### 🚨 緊急度：最高（バグ修正）
1. **スナップ位置の修正**
   - パネル境界での正確な吸着に修正
   - リサイズハンドル位置への誤った吸着を解消
   - 補助線と実際のスナップ位置の一致

### 🔥 緊急度：高（新機能追加）
1. **エクスポート機能実装**
   - PDF出力（ネーム用）
   - PNG画像出力
   - クリスタ用データ出力

2. **コマ結合機能**
   - 隣接するコマの結合
   - 分割の逆操作

### 📈 重要度：中（機能拡張）
1. **コマ複製機能**
   - Ctrl+C/Ctrl+V でのコピー&ペースト
   - 別パネルへの複製

2. **スナップ設定UI**
   - グリッドサイズの調整
   - スナップ感度の設定
   - スナップON/OFF切り替え

3. **背景・小物システム**
   - シンプルな背景要素
   - 効果線・集中線

### 🎨 重要度：低（UI改善）
1. **ヘルプ・チュートリアル機能**
2. **ショートカットキー一覧表示**
3. **操作ガイドのオーバーレイ表示**

## ✅ 今回の作業内容（2025-09-09 Part 2）

### 🆕 新規実装機能
1. **コマ右クリック編集機能**
   - 右クリック → 🔧 コマ編集で編集モード自動ON
   - パネル選択状態の自動設定
   - App.tsx ↔ CanvasComponent.tsx のコールバック連携

2. **グリッド表示システム**
   - 20px間隔のグリッド線表示
   - 編集モード時のみ表示
   - ダークモード対応色調整

3. **スナップ機能の実装**
   - 6種類の自動位置合わせ
   - リアルタイム補助線表示
   - 1px細線 + 0.5pxオフセットで鮮明表示

### 🔧 技術的改善
- **types.ts**: `onPanelEditModeToggle`コールバック追加
- **App.tsx**: 編集モード切り替えコールバック実装
- **CanvasComponent.tsx**: 右クリック編集・グリッド・スナップ統合
- **PanelRenderer.tsx**: グリッド描画・スナップ機能実装

### 🚨 発見された問題
1. **スナップ位置のズレ**: リサイズハンドル座標への誤った吸着
2. **補助線位置の不一致**: 表示される補助線と実際のスナップ位置のズレ

### 🎯 ユーザビリティ向上
- **右クリックからの編集開始**: ワンクリックで編集モード移行
- **視覚的ガイド**: グリッド表示で位置合わせが容易
- **リアルタイム補助線**: 移動中の位置確認が可能

## よくある問題と解決法（更新版）
- **コマ操作が効かない**: 編集モード（🔧）がONになっているか確認
- **ハンドルが表示されない**: コマを選択してから編集モードをON
- **右クリックメニューが出ない**: パネル部分を確実にクリックしているか確認
- **🔧 コマ編集が出ない**: パネル部分を右クリックしているか確認（編集モード外でもOK）
- **自動配置されない**: テンプレートをクリックしているか確認
- **分割ができない**: パネルが選択されているか、最小サイズに達していないか確認
- **スナップがズレる**: 現在調整中（パネル境界ではなくハンドル位置に吸着する問題）
- **グリッドが表示されない**: 編集モードがONになっているか確認

## 開発フロー
1. **バグ修正** → **機能追加** → **テスト** → **UI改善** → **ドキュメント更新** の順で進める
2. **ユーザーテスト**を重視し、直感的な操作性を最優先
3. **既存機能を壊さない**安全な開発を継続
4. **パフォーマンス**と**使いやすさ**のバランスを重視

## クイックスタート（新しいClaude向け）
このファイルを提示して「この状態から開発を続けてください」と言えば、現在の実装状況を把握して開発を継続できます。

**現在の状況**:
- ✅ 基本機能完成済み
- ✅ 座標系統一・UI改善完了
- ✅ キャラクター斜め方向機能完全実装済み
- ✅ **コマ操作機能完全実装済み**（移動・リサイズ・分割・削除）
- ✅ **パネルテンプレート自動配置完全実装済み**
- ✅ **右クリック編集機能完全実装済み**（NEW!）
- ✅ **グリッド表示システム完全実装済み**（NEW!）
- 🔧 **スナップ機能調整中**（吸着位置の修正が必要）

**次の目標**: 
1. **🚨 スナップ位置の修正**（最優先）
2. エクスポート機能の実装
3. コマ結合・複製機能
4. スナップ設定UI

## 開発コマンド
```bash
# 開発サーバー起動
npm start

# ビルド
npm run build

# 型チェック
npx tsc --noEmit

# Git保存
git add .
git commit -m "進行中: スナップ・グリッド機能（右クリック編集完了・スナップ位置調整中）"
git push origin main
```

## 🎉 プロジェクト達成状況

### Phase 1: 基本機能 ✅
- Canvas描画、キャラクター・吹き出し操作、テンプレート機能

### Phase 2: 高度な表現 ✅  
- 斜め方向、表情・ポーズシステム、シーンテンプレート

### Phase 3: コマ操作・自動化 ✅
- コマの移動・リサイズ・分割、パネルテンプレート自動配置

### Phase 4: コマ管理・UX向上 ✅
- コマ削除、右クリック拡張、感度調整

### Phase 5: グリッド・スナップ機能 ✅ **← 今回完了！**
- グリッド表示、右クリック編集、スナップ機能（パネル境界スナップ）

### Phase 6: エクスポート・拡張機能 🔜
- エクスポート機能、コマ結合・複製、背景システム

**進捗率: 85% 完了** 🚀

## 現在の実装状況

### ✅ 完了機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### 🆕 コマ操作機能（COMPLETE!）
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
  - **🆕 スナップ機能**: 隣接コマとの自動位置合わせ
  - **🆕 補助線表示**: 移動中に破線ガイド表示
  - **🆕 グリッドスナップ**: 20pxグリッドに自動吸着
- **コマリサイズ**: 8方向ハンドル
  - オレンジの四角（角）: 比例リサイズ
  - 緑の円（辺）: 一方向リサイズ
  - **🔧 感度調整**: 適切な操作感に調整済み
- **コマ分割**: 紫のハサミボタン（右下角）
  - 水平分割（上下）/ 垂直分割（左右）
- **🆕 コマ削除**: 複数の削除方法
  - 赤い×ボタン（左上角）
  - Delete/Backspaceキー
  - 右クリックメニュー → 🗑️ コマ削除
  - 削除確認ダイアログ + 子要素一括削除
- **🆕 右クリックメニュー拡張**: パネル操作の充実
  - 🔧 コマ編集（将来拡張用）
  - 水平分割 / 垂直分割
  - 🗑️ コマ削除
- **履歴対応**: コマ操作もアンドゥ/リドゥ可能

#### 🆕 パネルテンプレート自動配置（COMPLETE!）
- **6種類のテンプレート**に専用シーン自動配置
  - **4koma**: 4コマ漫画の典型的な構成（起承転結）
  - **dialogue**: 会話重視レイアウト（全体→アップ→結論）
  - **action**: アクション系ダイナミック構成
  - **emotional**: 感情表現重視の構成
  - **gag**: ギャグ・コメディのテンポ重視
  - **custom**: シンプルなカスタム用
- **自動配置要素**:
  - キャラクター（適切な位置・表情・ポーズ）
  - 吹き出し（シーンに合った種類・サイズ・配置）
  - 斜め方向機能を活用した高度な表現

#### 吹き出し機能
- 自由移動（パネル外移動可能）
- 3方向リサイズ（上下端/左右端/四隅で操作分岐）
- ダブルクリック編集
- 4種類の形状（普通/叫び/小声/心の声）
- 右クリックメニュー（編集・削除）

#### キャラクター機能
- 絶対座標での自由移動（パネル外移動可能）
- 8方向リサイズハンドル（吹き出しと同じ方式）
- 表示タイプ切り替え（顔のみ/上半身/全身）
- 4種類のキャラクター（主人公/ヒロイン/ライバル/友人）
- **8方向の顔の角度**: 正面/左/右/後ろ + 斜め4方向（leftFront/rightFront/leftBack/rightBack）
- **9方向の視線**: 中央/上下左右 + 斜め4方向（leftUp/rightUp/leftDown/rightDown）
- **サイズ制限拡張**: 最大5.0倍まで拡大可能（従来3.0倍から拡張）
- **斜め方向描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整
- **表情システム**: 8種類（ふつう/にっこり/かなしい/おこってる/びっくり/てれてる/こまった/ねむい）
- **ポーズシステム**: 6種類（立ってる/座ってる/歩いてる/指さし/手を振る/腕くみ）

#### シーンテンプレート機能
- 8種類のシーンテンプレート（基本5種類 + 斜め方向活用3種類）
  - **基本**: 日常/会話/アクション/感情/コメディ
  - **斜め方向活用**: 恋愛/緊張/驚き
- 選択パネルへの優先配置

#### 操作機能
- アンドゥ/リドゥ機能（Ctrl+Z/Ctrl+Y）
- 要素削除（Backspace/Delete）
- キーボードショートカット対応
- 右クリックコンテキストメニュー（詳細設定・編集・削除）
- **🆕 コマ編集モード切り替え（Ctrl+E）**
- **🆕 スナップ機能**: 隣接コマとの自動位置合わせ

#### UI機能
- デフォルトダークモード
- ライト/ダークモード切り替え
- 左右サイドバーレイアウト
- **キャラクター詳細設定パネル**: 簡略化されたUI（4方向/5視線/8表情/6ポーズ）
- **🆕 コマ編集モード表示**: 編集状態の視覚的フィードバック
- **🆕 操作状態表示**: 移動中・リサイズ中・削除確認の表示

#### ファイル構造
- 保守性向上のための構造化
- TypeScriptによる型安全性
- **🆕 コマ操作機能の分離**: PanelRenderer.tsxに集約
- **🆕 スナップ機能**: 高度な位置合わせシステム

### 🔄 進行中
- なし（コマ移動・削除・スナップ機能完了）

### 🐛 既知のバグ（修正済み）
- ~~吹き出し追加バグ~~: ✅ 修正完了
- ~~シーンテンプレート配置バグ~~: ✅ 修正完了
- ~~パネルリサイズ感度問題~~: ✅ 修正完了（感度調整）
- ~~パネル移動バグ~~: ✅ 修正完了（スナップ機能付き）

### 🚀 次に追加したい機能

#### 優先度：高
1. **エクスポート機能**: PDF、PNG、クリスタ用データ出力
2. **コマ結合機能**: 分割したコマを結合する機能
3. **コマ複製機能**: 既存のコマをコピー&ペースト

#### 優先度：中
1. **表情・ポーズのプリセット保存**: ユーザー独自の組み合わせ保存
2. **背景・小物システム**: シンプルな背景要素の追加
3. **セリフフォント設定**: 縦書き/横書き、フォントサイズの詳細設定
4. **スナップ設定**: グリッドサイズ・感度のユーザー設定

#### 優先度：低
1. **パフォーマンス最適化**: 大量要素での描画最適化
2. **レスポンシブ対応**: モバイル端末での操作性向上
3. **クラウド保存機能**: 作品のオンライン保存・共有

### ❌ 未実装・将来予定
1. **アニメーション機能**: 簡単な動きの表現
2. **コラボレーション機能**: 複数人での共同編集
3. **AI支援機能**: セリフ提案、構成アドバイス

## ファイル構造（最新版）
```
src/
├── types.ts                    # 共通型定義（コマ操作対応完了）
├── App.tsx                     # メインアプリ（自動配置・コマ編集モード対応）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（コマ移動・削除・スナップ完全対応）
│   ├── UI/
│   │   └── CharacterDetailPanel.tsx # キャラクター詳細設定（簡略化UI完了）
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx # 編集モーダル
│       ├── templates.ts        # パネルテンプレート定義（自動配置対応完了）
│       ├── sceneTemplates.ts   # シーンテンプレート定義（斜め方向活用完了）
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（斜め方向完全対応）
│           └── PanelRenderer.tsx     # パネル描画・操作（🆕 移動・削除・スナップ完全対応）
```

## 重要な技術詳細

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標（新規）+ 相対座標（既存・互換性）
- **パネル**: 絶対座標

### 🆕 コマ操作システム（完全実装）
- **移動**: 中央の青い円形ハンドル + スナップ機能
- **リサイズ**: 8方向ハンドル（角＝比例、辺＝一方向）+ 感度調整
- **分割**: 右下角のハサミボタン
- **削除**: 左上角×ボタン + キーボード + 右クリック
- **最小サイズ制限**: 50px（操作性を考慮）
- **履歴対応**: すべてのコマ操作がアンドゥ/リドゥ可能

### 🆕 スナップシステム（新規実装）
- **6種類のスナップ**: 左端・右端・中央（水平）、上端・下端・中央（垂直）
- **補助線表示**: リアルタイム破線ガイド
- **感度調整**: 15px以内で自動吸着
- **グリッドスナップ**: 20pxグリッドも対応
- **視覚的フィードバック**: ダークモード対応カラー

### 🆕 自動配置システム
- **テンプレート選択時**: パネル+キャラ+吹き出し を一括配置
- **シーン特化**: 各テンプレートに最適な構成を事前定義
- **座標計算**: 絶対座標での精密配置
- **ID管理**: 重複しない一意ID生成

### 操作方式（改善済み）
- **吹き出しリサイズ**: 領域ベース判定（上下端/左右端/四隅/中央）
- **キャラクターリサイズ**: 領域ベース判定（吹き出しと同じ方式）
- **🆕 パネルリサイズ**: ハンドルベース判定（8方向）+ 感度調整
- **移動**: ドラッグ&ドロップ（パネル外移動可能）+ スナップ機能

### キャラクター表現システム（完全実装済み）
- **顔の角度**: 8方向対応（front, left, right, back, leftFront, rightFront, leftBack, rightBack）
- **視線方向**: 9方向対応（center, left, right, up, down, leftUp, rightUp, leftDown, rightDown）
- **描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整、後ろ向き系の髪のみ表示
- **UI**: 簡略化された直感的なボタンUI

### 状態管理
- React useState でローカル管理
- 親子間コールバック方式
- **🆕 拡張履歴管理**: キャラ+吹き出し+パネル の3要素対応
- アンドゥ/リドゥ用操作履歴管理（50操作まで）
- **🆕 スナップライン管理**: リアルタイム補助線表示

## 起動方法
```bash
npm start
# http://localhost:3000 でアクセス
```

## 🆕 最新機能の使い方（更新版）

### コマ操作機能
1. **編集モード切り替え**: 右上の🔧ボタンまたは`Ctrl+E`
2. **コマ選択**: 編集モード時にコマをクリック
3. **移動**: 中央の青い円をドラッグ
   - **自動スナップ**: 他のコマに近づくと自動位置合わせ
   - **補助線表示**: 移動中に破線ガイド表示
4. **リサイズ**: 
   - オレンジの四角（角）: 比例リサイズ
   - 緑の円（辺）: 一方向リサイズ
   - **感度調整済み**: 適切な操作感
5. **分割**: 右下の紫ハサミボタン → 水平/垂直選択
6. **削除**: 
   - 左上の赤×ボタン
   - Delete/Backspaceキー
   - 右クリック → 🗑️ コマ削除

### パネルテンプレート自動配置
1. **左サイドバー**: パネルテンプレートを選択
2. **自動配置**: キャラクターと吹き出しが自動で配置される
3. **カスタマイズ**: 追加でシーンテンプレートやキャラクターを配置可能

### 右クリックメニュー（拡張版）
1. **パネル右クリック**: 編集モード時のみ表示
2. **🔧 コマ編集**: 将来の拡張用
3. **分割・削除**: 確認ダイアログ付き安全操作

## 次回開発時の優先事項

### 🔥 緊急度：高（新機能追加）
1. **エクスポート機能実装**
   - PDF出力（ネーム用）
   - PNG画像出力
   - クリスタ用データ出力

2. **コマ結合機能**
   - 隣接するコマの結合
   - 分割の逆操作

### 📈 重要度：中（機能拡張）
1. **コマ複製機能**
   - Ctrl+C/Ctrl+V でのコピー&ペースト
   - 別パネルへの複製

2. **背景・小物システム**
   - シンプルな背景要素
   - 効果線・集中線

3. **スナップ設定UI**
   - グリッドサイズの調整
   - スナップ感度の設定
   - スナップON/OFF切り替え

### 🎨 重要度：低（UI改善）
1. **ヘルプ・チュートリアル機能**
2. **ショートカットキー一覧表示**
3. **操作ガイドのオーバーレイ表示**

## ✅ 今回の作業内容（2025-09-09）

### 🆕 新規実装機能
1. **コマ削除機能**
   - 左上角赤×ボタンでの削除
   - Delete/Backspaceキーでの削除
   - 右クリックメニューからの削除
   - 確認ダイアログ + 子要素一括削除

2. **スナップ機能システム**
   - 6種類の自動位置合わせ（水平3種類・垂直3種類）
   - リアルタイム補助線表示（破線）
   - グリッドスナップ（20px）
   - ダークモード対応カラー

3. **右クリックメニュー拡張**
   - 🔧 コマ編集メニュー追加
   - 🗑️ コマ削除メニュー追加
   - 視覚的改善（アイコン付き）

### 🔧 技術的改善
- **PanelRenderer.tsx**: スナップ機能・削除機能の完全実装
- **CanvasComponent.tsx**: スナップライン管理・右クリック拡張
- **リサイズ感度調整**: 適切な操作感に改善
- **座標計算最適化**: より正確な位置計算
- **状態管理拡張**: スナップライン状態の追加

### 🎯 ユーザビリティ向上
- **直感的な操作**: スナップによる簡単位置合わせ
- **視覚的フィードバック**: 補助線とハンドル表示
- **安全な削除**: 確認ダイアログで誤操作防止
- **豊富な操作方法**: マウス・キーボード・右クリック対応

## よくある問題と解決法（更新版）
- **コマ操作が効かない**: 編集モード（🔧）がONになっているか確認
- **ハンドルが表示されない**: コマを選択してから編集モードをON
- **自動配置されない**: テンプレートをクリックしているか確認
- **分割ができない**: パネルが選択されているか、最小サイズに達していないか確認
- **削除の確認が出ない**: 編集モードでパネルが選択されているか確認
- **スナップが効かない**: 他のコマから15px以内に近づけてみる
- **補助線が消えない**: マウスを離すと自動的に消える

## 開発フロー
1. **機能追加** → **テスト** → **UI改善** → **ドキュメント更新** の順で進める
2. **ユーザーテスト**を重視し、直感的な操作性を最優先
3. **既存機能を壊さない**安全な開発を継続
4. **パフォーマンス**と**使いやすさ**のバランスを重視

## クイックスタート（新しいClaude向け）
このファイルを提示して「この状態から開発を続けてください」と言えば、現在の実装状況を把握して開発を継続できます。

**現在の状況**:
- ✅ 基本機能完成済み
- ✅ 座標系統一・UI改善完了
- ✅ キャラクター斜め方向機能完全実装済み
- ✅ **コマ操作機能完全実装済み**（移動・リサイズ・分割）
- ✅ **パネルテンプレート自動配置完全実装済み**
- ✅ **コマ削除機能完全実装済み**（NEW!）
- ✅ **スナップ機能完全実装済み**（NEW!）

**次の目標**: 
1. エクスポート機能の実装
2. コマ結合・複製機能
3. 背景・小物システム
4. スナップ設定UI

## 開発コマンド
```bash
# 開発サーバー起動
npm start

# ビルド
npm run build

# 型チェック
npx tsc --noEmit

# Git保存
git add .
git commit -m "完了: コマ移動・削除・スナップ機能（位置合わせ補助線・右クリック拡張・削除確認）"
git push origin main
```

## 🎉 プロジェクト達成状況

### Phase 1: 基本機能 ✅
- Canvas描画、キャラクター・吹き出し操作、テンプレート機能

### Phase 2: 高度な表現 ✅  
- 斜め方向、表情・ポーズシステム、シーンテンプレート

### Phase 3: コマ操作・自動化 ✅
- コマの移動・リサイズ・分割、パネルテンプレート自動配置

### Phase 4: コマ管理・UX向上 ✅ **← 今回完了！**
- コマ削除、スナップ機能、右クリック拡張、感度調整

### Phase 5: エクスポート・拡張機能 🔜
- エクスポート機能、コマ結合・複製、背景システム

**進捗率: 80% 完了** 🚀