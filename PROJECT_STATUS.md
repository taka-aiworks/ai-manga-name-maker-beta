# ネーム制作ツール - プロジェクト状況ファイル（エクスポートUI統一完成・新機能構想追加版）

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas + jsPDF + html2canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月9日（エクスポートUI統一完成）
- **🆕 最新機能**: PDF・PNG・PSD出力機能 + 既存UI完全統一

## 現在の実装状況

### ✅ 完了機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### コマ操作機能（COMPLETE!）
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
- **スナップ機能**: 隣接コマとの自動位置合わせ（完了）
- **補助線表示**: 移動中に破線ガイド表示（完了）
- **グリッド表示**: 20pxグリッド表示（編集モード時）
- **コマリサイズ**: 8方向ハンドル
- **コマ分割**: 紫のハサミボタン（右下角）
- **コマ削除**: 複数の削除方法
- **右クリックメニュー拡張**: パネル操作の充実

#### パネルテンプレート自動配置（COMPLETE!）
- **6種類のテンプレート**に専用シーン自動配置
- **自動配置要素**: キャラクター・吹き出し・斜め方向機能活用

#### 吹き出し機能
- 自由移動（パネル外移動可能）
- 3方向リサイズ
- ダブルクリック編集
- 4種類の形状
- 右クリックメニュー

#### キャラクター機能
- 絶対座標での自由移動
- 8方向リサイズハンドル
- 表示タイプ切り替え
- 4種類のキャラクター
- **8方向の顔の角度**
- **9方向の視線**
- **斜め方向描画システム**
- **表情システム**: 8種類
- **ポーズシステム**: 6種類

#### 🆕 エクスポート機能（COMPLETE!）
- **PDF出力**: ネーム用レイアウト（A4サイズ自動調整）
  - 全体を1ページで出力
  - 各コマを別ページで出力（オプション）
- **PNG画像出力**: 高画質画像ファイル
  - 全体画像の出力
  - 各コマの個別出力
  - 3段階品質設定（高・中・低）
- **PSD（クリスタ用）出力**: レイヤー構造付きデータ
  - レイヤー構造のJSON出力
  - 各要素を個別PNGで出力
  - クリスタでの読み込み対応

#### ✅ エクスポートUI（統一完成版）
- **ワンクリック開閉システム**: 同じボタンで設定展開・収納
- **既存UI完全統一**: ダークモード・フォント・色・サイズすべて統一
- **用途別最適化設定**: 印刷用PDF・画像保存・クリスタ用の専用設定
- **自動最適化**: 用途選択時に推奨設定を自動適用
- **プログレス表示**: リアルタイム進行状況（オレンジプログレスバー）
- **完全ダークモード対応**: リアルタイムテーマ変更対応

#### 操作機能
- アンドゥ/リドゥ機能
- 要素削除
- キーボードショートカット対応
- 右クリックコンテキストメニュー
- スナップ機能（完了）

#### UI機能
- デフォルトダークモード
- ライト/ダークモード切り替え
- 左右サイドバーレイアウト
- コマ編集モード表示
- 操作状態表示
- グリッド表示

### 🎉 最新達成項目（2025-09-09）
1. ✅ **エクスポートUI既存統一完成**: 他のUIと完全に統一されたデザイン
2. ✅ **ダークモード完全対応**: リアルタイム切り替え対応
3. ✅ **型エラー完全修正**: TypeScript型定義の整合性確保
4. ✅ **ワンクリック操作**: 直感的なUI/UX改善

### 🐛 既知のバグ

#### 修正済み
- ~~吹き出し追加バグ~~: ✅ 修正完了
- ~~シーンテンプレート配置バグ~~: ✅ 修正完了
- ~~パネルリサイズ感度問題~~: ✅ 修正完了
- ~~右クリックメニュー表示問題~~: ✅ 修正完了
- ~~スナップ位置のズレ~~: ✅ 修正完了
- ~~補助線と実際の位置の不一致~~: ✅ 修正完了
- ~~エクスポート機能の型エラー~~: ✅ **修正完了（2025-09-09）**
- ~~UI表示エラー~~: ✅ **修正完了（2025-09-09）**

#### 🚨 現在の問題
- **現在、重大なバグはありません！** 🎉

### 🚀 次に追加したい機能

#### 優先度：高（基本機能拡張）
1. **🔗 コマ結合機能**: 分割したコマを結合する逆操作
2. **📋 コマ複製機能**: Ctrl+C/Ctrl+V でのコピー&ペースト
3. **⚙️ スナップ設定UI**: グリッドサイズ・感度のユーザー設定

#### 優先度：中（機能充実）
1. **🎨 背景・小物システム**: 効果線・集中線の追加
2. **💾 表情・ポーズプリセット保存**: ユーザー独自の組み合わせ保存
3. **📝 セリフフォント設定**: 縦書き/横書き、フォントサイズ調整

#### 🆕 優先度：革新的機能（次世代ネーム制作）
1. **🤖 ChatGPT API連携**:
   - 物語構想の相談・アイデア出し機能
   - 会話しながらネーム構成を決められるAIアシスタント
   - キャラクター設定や世界観の相談機能
   - セリフの推敲・改善提案
   - ストーリー展開のアドバイス機能

2. **🎯 3Dキャラクター表示**:
   - 現在の2Dアイコンを3Dモデルで表示
   - より直感的なポーズ・表情設定
   - 立体的な角度確認機能
   - カメラアングルの自由設定
   - リアルタイム3D描画（Three.js活用）

3. **📝 プロンプトメーカー連携**:
   - キャラクターの表情・ポーズ情報の自動プロンプト化
   - AIイラスト生成用のプロンプト自動作成
   - キャラクター設定のテキスト出力
   - 画像生成AI（Stable Diffusion/Midjourney）対応形式
   - プロンプトのカスタマイズ・保存機能

### ❌ 未実装・将来予定
1. **⚡ パフォーマンス最適化**: 大量コマ対応
2. **🌐 クラウド保存機能**: 作品のオンライン保存・共有
3. **👥 コラボレーション機能**: 複数人での共同編集
4. **📱 モバイル対応**: タブレット・スマホでの操作
5. **🎬 アニメーション機能**: 簡単な動きの表現

## ファイル構造（統一完成版）
```
src/
├── types.ts                    # 共通型定義
├── App.tsx                     # メインアプリ（エクスポート統合）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（forwardRef対応）
│   ├── UI/
│   │   ├── CharacterDetailPanel.tsx # キャラクター詳細設定
│   │   └── ExportPanel.tsx          # ✅ エクスポートUI（統一完成）
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx      # 編集モーダル
│       ├── templates.ts             # パネルテンプレート定義
│       ├── sceneTemplates.ts        # シーンテンプレート定義
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作
│           └── PanelRenderer.tsx     # パネル描画・操作
├── services/                   # 外部サービス
│   └── ExportService.ts        # エクスポート機能中核
└── 必要なライブラリ
    ├── jspdf                   # PDF生成
    ├── html2canvas            # キャンバス画像化
    └── @types/jspdf           # TypeScript型定義
```

## 🆕 革新的機能の技術検討

### ChatGPT API連携の技術スタック
```bash
# 必要な追加ライブラリ
npm install openai
npm install @types/openai

# 環境変数設定
REACT_APP_OPENAI_API_KEY=your_api_key
```

**想定機能:**
- ストーリー相談チャット
- キャラクター設定生成
- セリフ改善提案
- プロット構成アドバイス

### 3D表示の技術スタック
```bash
# 3D描画ライブラリ（既存のThree.jsを拡張）
npm install @react-three/fiber
npm install @react-three/drei
npm install three

# 3Dモデル形式
- .glb/.gltf ファイル対応
- VRMファイル対応検討
```

**想定機能:**
- 3Dキャラクターのリアルタイム描画
- ポーズ・表情の直感的操作
- カメラアングル自由設定
- 2D/3D表示切り替え

### プロンプトメーカー連携の仕様
```typescript
interface CharacterPrompt {
  character: string;        // キャラクター名
  expression: string;       // 表情
  pose: string;            // ポーズ
  bodyDirection: string;   // 体の向き
  eyeDirection: string;    // 視線
  viewType: string;        // 表示タイプ
  setting: string;         // 背景・設定
  mood: string;           // 雰囲気
}
```

**出力例:**
```
"A young hero character with a confident smile, standing pose, facing front, looking forward, half-body shot, in a bright outdoor setting, heroic mood"
```

## 重要な技術詳細（統一完成版）

### エクスポートUI統一のポイント
- **ダークモード検出**: `document.documentElement.getAttribute("data-theme")`
- **色統一**: オレンジアクセント（`#ff8833`）で既存UIと完全統一
- **フォント統一**: `fontFamily: "inherit"` で一貫性確保
- **サイズ統一**: 12px基準のフォントサイズ
- **スタイル統一**: インラインスタイルで既存パターン踏襲

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標 + 相対座標（互換性）
- **パネル**: 絶対座標
- **エクスポート**: 絶対座標ベースでの位置計算

### コマ操作システム（完全実装）
- **移動**: 中央の青い円形ハンドル + スナップ機能
- **リサイズ**: 8方向ハンドル + 感度調整
- **分割**: 右下角のハサミボタン
- **削除**: 複数の削除方法
- **履歴対応**: すべてのコマ操作がアンドゥ/リドゥ可能

### スナップシステム（完全実装）
- **6種類のスナップ**: 左端・右端・中央（水平）、上端・下端・中央（垂直）
- **補助線表示**: リアルタイム破線ガイド
- **感度調整**: 12px以内で自動吸着
- **グリッドスナップ**: 20pxグリッド対応

## 起動方法（統一完成版）
```bash
# 基本起動
npm start

# エクスポート用ライブラリインストール
npm install jspdf html2canvas @types/jspdf

# 革新的機能用ライブラリ（将来）
npm install openai @react-three/fiber @react-three/drei

# http://localhost:3000 でアクセス
```

## エクスポート機能の使い方

### 基本的な使い方
1. **用途選択**: 右サイドバーの「出力」セクションで用途ボタンをクリック
2. **設定確認**: 選択した用途に最適化された設定を確認・調整
3. **出力実行**: 「出力する」ボタンで開始
4. **進行確認**: オレンジのプログレスバーで進捗確認

### 用途別の推奨設定
- **印刷用PDF**: 300DPI・白背景ON・ページ分割オプション
- **画像保存**: 標準品質・透明背景オプション・SNS最適化
- **クリスタ用**: 300DPI・レイヤー分離・JSON構造出力

## よくある問題と解決法（統一完成版）
- **コマ操作が効かない**: 編集モード（🔧）がONになっているか確認
- **エクスポートボタンが押せない**: コマが1つ以上作成されているか確認
- **PDF出力が小さい**: 解像度設定を300DPI以上に設定
- **PNG背景が白い**: 「背景を透明にする」にチェック
- **クリスタでレイヤーが読めない**: JSONファイルと個別PNGファイルの両方が必要
- **ダークモードで見えない**: 自動でテーマ検出されているか確認

## 技術要件（統一完成版）

### 現在の必要ライブラリ
```bash
# 基本
npm install react react-dom typescript
npm install @types/react @types/react-dom

# エクスポート機能
npm install jspdf html2canvas @types/jspdf

# 3D描画（既存）
npm install three @types/three
```

### 革新的機能用の追加ライブラリ（計画）
```bash
# ChatGPT API
npm install openai @types/openai

# 3D拡張
npm install @react-three/fiber @react-three/drei

# プロンプト処理
npm install marked @types/marked
```

### ブラウザ要件
- **Canvas API**: 描画・キャプチャ
- **File API**: ダウンロード機能
- **ES6+ Support**: async/await・Promise
- **WebGL**: 3D描画対応（将来）

## 開発フロー（統一完成版）
1. **🔗 コマ結合機能** → **📋 コマ複製機能** → **⚙️ スナップ設定UI** → **🤖 ChatGPT連携** → **🎯 3D表示** → **📝 プロンプト連携** の順で進める
2. **段階的導入**を重視し、既存機能を壊さずに新機能を追加
3. **ユーザーテスト**を各段階で実施し、使いやすさを検証
4. **パフォーマンス**と**革新性**のバランスを重視

## クイックスタート（新しいClaude向け・統一完成版）
このファイルを提示して「このプロジェクトの開発を続けてください」と言えば、現在の実装状況と次の開発目標を把握して開発を継続できます。

**現在の状況**:
- ✅ 基本機能完成済み
- ✅ コマ操作機能完全実装済み
- ✅ パネルテンプレート自動配置完全実装済み
- ✅ **エクスポート機能完全実装済み**（PDF・PNG・PSD対応）
- ✅ **エクスポートUI既存統一完成**（ダークモード・フォント・色完全統一）
- ✅ **型エラー完全修正済み**

**次の目標**: 
1. 🔗 コマ結合機能の実装
2. 📋 コマ複製機能の実装
3. 🤖 ChatGPT API連携（革新的機能）
4. 🎯 3Dキャラクター表示（次世代UI）
5. 📝 プロンプトメーカー連携（AI活用）

## 開発コマンド（統一完成版）
```bash
# 開発サーバー起動
npm start

# 現在のライブラリ
npm install jspdf html2canvas @types/jspdf

# 革新的機能用（将来）
npm install openai @react-three/fiber @react-three/drei

# 型チェック
npx tsc --noEmit

# ビルド（本番用）
npm run build

# Git保存
git add .
git commit -m "完了: エクスポートUI既存統一完成（ダークモード・フォント・色完全統一）+ 革新的機能構想追加"
git push origin main
```

## 🎉 プロジェクト達成状況（統一完成版）

### Phase 1: 基本機能 ✅
- Canvas描画、キャラクター・吹き出し操作、テンプレート機能

### Phase 2: 高度な表現 ✅  
- 斜め方向、表情・ポーズシステム、シーンテンプレート

### Phase 3: コマ操作・自動化 ✅
- コマの移動・リサイズ・分割、パネルテンプレート自動配置

### Phase 4: コマ管理・UX向上 ✅
- コマ削除、右クリック拡張、感度調整

### Phase 5: グリッド・スナップ機能 ✅
- グリッド表示、右クリック編集、スナップ機能

### Phase 6: エクスポート機能 ✅ **← 完了！**
- PDF出力、PNG画像出力、PSD（クリスタ用）出力

### Phase 6.5: UI統一・完成度向上 ✅ **← 今回完了！**
- エクスポートUI既存統一、ダークモード完全対応、型エラー修正

### Phase 7: 基本機能拡張 🔜 **← 次の目標！**
- コマ結合・複製、スナップ設定UI

### 🆕 Phase 8: 革新的機能（AI・3D・連携） 🌟 **← 未来の目標！**
- ChatGPT API連携、3Dキャラクター表示、プロンプトメーカー連携

**現在の進捗率: 95% 完了** 🚀
**革新的機能込み進捗率: 75% 完了** 🌟

---

## 🎯 開発ロードマップ（統一完成・革新的機能追加版）

### 短期目標（1-2週間）
1. 🔗 コマ結合機能の実装
2. 📋 コマ複製機能の実装
3. ⚙️ スナップ設定UI完成

### 中期目標（1ヶ月）
1. 🤖 ChatGPT API連携の基礎実装
2. 🎨 背景・小物システム実装
3. 💾 プリセット保存機能実装

### 長期目標（2-3ヶ月）
1. 🎯 3Dキャラクター表示システム
2. 📝 プロンプトメーカー連携完成
3. 🌐 クラウド保存・共有機能

### 革新的目標（半年）
1. 🤖 高度なAIアシスタント機能
2. 🎯 VR/AR対応検討
3. 📱 モバイルアプリ化

**この統一完成により、ツールの完成度が大幅に向上し、次の革新的機能開発への基盤が整いました！** ✨

そして追加された3つの革新的機能により、**「単なるネーム制作ツール」から「AI活用型次世代クリエイティブプラットフォーム」** への進化が始まります！🚀🌟

## 🌟 革新的機能の価値
1. **🤖 ChatGPT連携**: 創作の壁を破る「AIブレインストーミング」
2. **🎯 3D表示**: 直感的で立体的な「次世代ネーム制作」
3. **📝 プロンプト連携**: 現代のAIアート時代に対応した「創作ワークフロー統合」