# ネーム制作ツール - プロジェクト状況ファイル

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月8日（キャラクター斜め方向機能追加）

## 現在の実装状況

### ✅ 完了機能
- **基本Canvas描画**: パネル、キャラクター、吹き出しの表示
- **吹き出し機能**: 
  - 自由移動（パネル外移動可能）
  - 3方向リサイズ（上下端/左右端/四隅で操作分岐）
  - ダブルクリック編集
  - 4種類の形状（普通/叫び/小声/心の声）
- **キャラクター機能**: 
  - 絶対座標での自由移動（パネル外移動可能）
  - 8方向リサイズハンドル（吹き出しと同じ方式）
  - 表示タイプ切り替え（顔のみ/上半身/全身）
  - 4種類のキャラクター（主人公/ヒロイン/ライバル/友人）
  - **🆕 8方向の顔の角度**: 正面/左/右/後ろ + 斜め4方向（左前/右前/左後ろ/右後ろ）
  - **🆕 9方向の視線**: 中央/上下左右 + 斜め4方向（左上/右上/左下/右下）
  - **🆕 サイズ制限拡張**: 最大5.0倍まで拡大可能（従来3.0倍から拡張）
- **テンプレート機能**: 
  - 6種類のパネルレイアウト
  - 5種類のシーンテンプレート（キャラ・吹き出し自動配置）
  - **🆕 斜め方向対応シーンテンプレート**: 恋愛シーン・緊張シーンなど追加予定
- **操作機能**:
  - アンドゥ/リドゥ機能（Ctrl+Z/Ctrl+Y）
  - 要素削除（Backspace/Delete）
  - キーボードショートカット対応
- **UI機能**:
  - デフォルトダークモード
  - ライト/ダークモード切り替え
  - 左右サイドバーレイアウト
  - **🆕 キャラクター詳細設定パネル**: 8×9方向の直感的なグリッドUI
- **ファイル分割**: 保守性向上のための構造化
- **型定義統一**: TypeScriptによる型安全性

### 🔄 進行中
- **キャラクター斜め方向機能の実装**: 型定義・UI設計完了、描画処理実装中

### 🐛 既知のバグ（要修正）
1. **吹き出し追加バグ**: パネル未選択状態で吹き出し追加が機能しない
   - 「パネル未選択でも追加可能」と表示されているが実際は追加されない
   - App.tsx の addBubbleFunc 呼び出し処理に問題がある可能性

2. **シーンテンプレート配置バグ**: どのパネルを選択してもパネル1に配置される
   - sceneTemplates.ts の applySceneTemplate 関数が常に panels[0] を使用
   - 選択中のパネルを優先すべき

### 🚀 追加したい機能
1. ~~**キャラクターサイズ制限解除**~~ ✅ **完了**: 5.0倍まで拡張済み

2. **パネルテンプレート自動配置**
   - パネルテンプレート選択時にキャラクターと吹き出しをデフォルト配置
   - 各テンプレートに適したシーン構成を自動生成

3. ~~**キャラクター表示切り替え強化**~~ ✅ **完了**: 3×3グリッドUI実装済み

4. ~~**キャラクター詳細設定**~~ ✅ **完了**: 
   - ~~向き: 左向き/正面/右向き/後ろ向き~~ → **8方向対応済み**
   - ~~視線: 左/中央/右/上/下~~ → **9方向対応済み**
   - 表情: 普通/笑顔/怒り/悲しみ/驚き （未実装）
   - ポーズ: 立ち/座り/走り/ジャンプ （未実装）

5. **🆕 新シーンテンプレート実装**
   - 恋愛シーン: 斜め向きでの照れた表情
   - 緊張シーン: 後ろ向きと振り返りの組み合わせ

### ❌ 未実装・低優先度
1. **エクスポート機能**: PDF、PNG、クリスタ用データ出力
2. **パフォーマンス最適化**: 大量要素での描画最適化
3. **レスポンシブ対応**: モバイル端末での操作性向上
4. **表情・ポーズバリエーション**: より詳細な感情表現

## ファイル構造
```
src/
├── types.ts                    # 共通型定義（斜め方向対応型追加）
├── App.tsx                     # メインアプリ（アンドゥ/リドゥ・左右レイアウト対応）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（座標系統一済み）
│   ├── UI/
│   │   └── CharacterDetailPanel.tsx # キャラクター詳細設定（8×9方向UI）
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx # 編集モーダル
│       ├── templates.ts        # パネルテンプレート定義
│       ├── sceneTemplates.ts   # シーンテンプレート定義（斜め方向対応済み）
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（斜め方向対応）
│           └── PanelRenderer.tsx     # パネル描画・操作（ダークモード対応）
```

## 重要な技術詳細

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標（新規）+ 相対座標（既存・互換性）
- **パネル**: 絶対座標

### 操作方式（改善済み）
- **吹き出しリサイズ**: 領域ベース判定（上下端/左右端/四隅/中央）
- **キャラクターリサイズ**: 領域ベース判定（吹き出しと同じ方式）
- **移動**: ドラッグ&ドロップ（パネル外移動可能）

### 🆕 キャラクター表現システム
- **顔の角度**: 8方向対応（front, left, right, back, leftFront, rightFront, leftBack, rightBack）
- **視線方向**: 9方向対応（center, left, right, up, down, leftUp, rightUp, leftDown, rightDown）
- **描画システム**: 角度に応じた目の位置調整、髪型変化、体の向き調整
- **UI**: 3×3グリッドでの直感的な方向選択

### 状態管理
- React useState でローカル管理
- 親子間コールバック方式
- アンドゥ/リドゥ用操作履歴管理

## 起動方法
```bash
npm start
# http://localhost:3000 でアクセス
```

## 次回開発時の優先事項

### 🔥 緊急度：高（バグ修正）
1. **吹き出し追加バグ修正**
   - App.tsx の handleBubbleClick 関数確認
   - addBubbleFunc の呼び出しタイミング検証

2. **シーンテンプレート配置バグ修正**
   - sceneTemplates.ts の applySceneTemplate 関数修正
   - 選択パネル優先ロジックの実装

### 📈 重要度：中（機能追加）
1. **🆕 斜め方向描画機能の完全実装**
   - CharacterRenderer.tsx の斜め方向描画関数実装
   - 既存の目描画処理を新しい関数に置き換え

2. **パネルテンプレート自動配置**
   - templates.ts にデフォルトシーン定義追加
   - テンプレート選択時の自動配置ロジック

3. **🆕 新シーンテンプレートの追加**
   - 恋愛シーン（romance）
   - 緊張シーン（tension）

### 🎨 重要度：低（UI改善）
1. **表情・ポーズ選択UI**
2. **操作説明の充実**
3. **プリセット保存機能**

## 🆕 新機能の使い方

### キャラクター斜め方向設定
1. **キャラクター選択** → 右側に詳細パネル表示
2. **顔の角度**: 3×3グリッドから8方向選択
   ```
   ↖️ ⬆️ ↗️
   ⬅️ ⚪ ➡️
   ↙️    ↘️
   ```
3. **視線方向**: 3×3グリッドから9方向選択
   ```
   ↖️ ⬆️ ↗️
   ⬅️ ⚪ ➡️
   ↙️ ⬇️ ↘️
   ```
4. **サイズ**: 0.3〜5.0倍まで調整可能

### 表現例
- **会話シーン**: `leftFront` + `rightDown` で照れた表情
- **アクションシーン**: `rightFront` + `rightUp` で勢いのある視線
- **緊張シーン**: `back` + `center` で不安な後ろ姿
- **振り返り**: `leftBack` + `left` で振り返る瞬間

## よくある問題と解決法
- **リサイズが効かない**: 状態管理（isDragging, isBubbleResizing）のリセット確認
- **座標がずれる**: 絶対座標と相対座標の計算ミス
- **型エラー**: types.ts の型定義確認（斜め方向の型追加確認）
- **要素が追加されない**: パネル存在確認とコールバック関数の設定確認
- **🆕 斜め方向が表示されない**: CharacterRenderer.tsx の新しい描画関数が呼ばれているか確認

## 前回セッションでの教訓
- 座標系統一により操作性が大幅に向上
- アンドゥ/リドゥ機能で作業効率が改善
- 左右レイアウトで画面を有効活用
- **🆕 既存コードの完全置き換えは危険**: 部分的な修正・追加が安全
- **🆕 型定義の拡張**: 後方互換性を保ちながら新機能を追加

## 開発フロー
1. **バグ修正** → **機能追加** → **UI改善** の順で進める
2. **部分的な修正・追加** → **テスト** → **コミット** を習慣化
3. **既存機能を壊さない**安全な開発を重視
4. **ユーザーフィードバック**を積極的に収集

## クイックスタート（新しいClaude向け）
このファイルを提示して「この状態から開発を続けてください」と言えば、現在の実装状況を把握して開発を継続できます。

**現在の状況**:
- 基本機能は完成済み
- 座標系統一・UI改善完了
- **🆕 キャラクター斜め方向機能**: 設計完了、実装中
- バグ修正と残り機能実装が次のフェーズ

**次の目標**: 
1. 斜め方向描画機能の完全実装
2. 吹き出し追加バグとシーンテンプレート配置バグの修正
3. 新シーンテンプレートの追加

## 🆕 今回の作業内容（2025-09-08）

### 完了した作業
- [x] キャラクター型定義の拡張（8方向の顔角度・9方向の視線）
- [x] CharacterDetailPanel の UI設計（3×3グリッド）
- [x] サイズ制限の拡張（5.0倍まで）
- [x] 新シーンテンプレートの設計（恋愛・緊張シーン）

### 残りの作業
- [ ] CharacterRenderer.tsx の斜め方向描画実装
- [ ] 既存目描画処理の新関数への置き換え
- [ ] 新シーンテンプレートのテスト
- [ ] 既知バグの修正

## 開発コマンド
```bash
# 開発サーバー起動
npm start

# ビルド
npm run build

# 型チェック
npx tsc --noEmit

# Git保存
git add .
git commit -m "機能追加: キャラクター斜め方向対応（8方向顔角度・9方向視線）"
git push origin main
```