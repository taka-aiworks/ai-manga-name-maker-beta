# ネーム制作ツール - プロジェクト状況ファイル（リサイズバグ発生版）

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas + jsPDF + html2canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月10日（リサイズ機能バグ発生）
- **現在の状況**: ファイル分割後にリサイズ機能が動作不良

## 🚨 **現在発生中のバグ**

### **リサイズ機能完全停止**
- **症状**: 吹き出しとキャラクターのリサイズが一切動作しない
- **発生タイミング**: ファイル分割作業後
- **元々の状態**: Phase 8完了時点では正常動作していた
- **影響範囲**: 
  - 吹き出しの8方向リサイズハンドル → 表示されるがクリックしても動作しない
  - キャラクターの8方向リサイズハンドル → 表示されるがクリックしても動作しない
  - 移動機能 → 正常動作（バグなし）

### **技術的詳細**
```
ログ出力:
🖱️ マウス移動イベント発生
❌ 移動処理スキップ: {isDragging: false, isResizing: false, isBubbleResizing: false}
```

**根本原因**: 
- `isBubbleResizing` フラグが `true` にならない
- `isCharacterResizing` フラグが `true` にならない
- リサイズハンドルクリック判定が失敗している

### **影響を受けるファイル**
1. `src/components/CanvasComponent.tsx` - マウスイベント処理
2. `src/components/CanvasArea/renderers/BubbleRenderer.tsx` - リサイズ処理
3. `src/components/CanvasArea/renderers/CharacterRenderer.tsx` - リサイズ処理

## 現在の実装状況

### ✅ 正常動作中の機能

#### 基本Canvas描画
- パネル、キャラクター、吹き出しの表示
- ダークモード対応の描画システム

#### スナップ設定UI機能
- **✅ スナップON/OFF**: ワンクリックで有効/無効切り替え
- **📐 グリッドサイズ選択**: 10px / 20px / 40px から選択可能
- **⚙️ スナップ感度調整**: 弱(6px) / 中(12px) / 強(20px) の3段階
- **👁️ グリッド表示設定**: 常時表示 / 編集時のみ / 非表示
- **🎯 リアルタイム反映**: 設定変更が即座にキャンバスに反映
- **📊 状態表示**: 現在のスナップ設定を右上に表示

#### コマ操作機能
- **コマ編集モード**: Ctrl+E または画面上部ボタンで切り替え
- **コマ移動**: 青い円形ハンドル（中央）をドラッグ
- **カスタマイズ可能スナップ機能**: ユーザー設定に基づく自動位置合わせ
- **補助線表示**: 移動中に破線ガイド表示（設定可能）
- **設定可能グリッド表示**: サイズ・表示タイミングをカスタマイズ
- **コマリサイズ**: 8方向ハンドル
- **コマ分割**: 紫のハサミボタン（右下角）
- **コマ削除**: 複数の削除方法
- **コマ複製**: 右クリック「📋 コマ複製」でパネル内要素も一緒に複製

#### パネルテンプレート自動配置
- **6種類のテンプレート**に専用シーン自動配置
- **自動配置要素**: キャラクター・吹き出し・斜め方向機能活用

#### 要素移動機能（正常動作）
- **吹き出し移動**: 自由移動（パネル外移動可能）
- **キャラクター移動**: 絶対座標での自由移動
- **ダブルクリック編集**: 吹き出しテキスト編集
- **右クリックメニュー**: 全機能正常動作

#### コピー&ペースト機能
- **Ctrl+C**: 選択中の要素（コマ・キャラ・吹き出し）をコピー
- **Ctrl+V**: コピーした要素をペースト
- **右クリックメニュー**: 「📋 コピー」「📌 ペースト」ボタン
- **クリップボード表示**: 右上にコピー中の要素を表示
- **Delete/Backspace**: 選択中の要素を削除
- **Escape**: 選択解除

#### エクスポート機能
- **PDF出力**: ネーム用レイアウト（A4サイズ自動調整）
- **PNG画像出力**: 高画質画像ファイル
- **PSD（クリスタ用）出力**: レイヤー構造付きデータ

#### その他機能
- **反転機能**: 水平反転・垂直反転（編集モード時のみ）
- **アンドゥ/リドゥ機能**: 操作履歴管理
- **キーボードショートカット対応**: 各種ショートカット
- **UI機能**: ダークモード・サイドバーレイアウト

### 🚨 **動作不良の機能**

#### リサイズ機能（完全停止）
- **❌ 吹き出しリサイズ**: 8方向ハンドル表示されるがクリック無効
- **❌ キャラクターリサイズ**: 8方向ハンドル表示されるがクリック無効
- **原因**: マウスダウン時にリサイズモードフラグが設定されない

### 🎉 Phase 8で完了していた項目（現在バグ発生）
1. ✅ **スナップ設定UI実装**: グリッドサイズ・感度・表示設定の完全カスタマイズ
2. ✅ **PanelManager分割**: パネル操作ロジックを独立モジュール化（350行分離）
3. ✅ **ContextMenuHandler分割**: 右クリックメニュー処理を独立モジュール化（250行分離）
4. ✅ **型定義拡張**: SnapSettings型の追加とCanvasComponentProps更新
5. ✅ **設定連携システム**: App.tsx → CanvasComponent.tsx → PanelManager.ts の完全な設定伝達
6. ✅ **コードベース最適化**: CanvasComponent.tsx を1000行 → 600行に削減（40%削減）
7. **❌ リサイズ機能**: 分割作業中に破損

## 🔧 **修復が必要な作業**

### **Phase 8.1: リサイズ機能緊急修復** 🚨
**最優先**: 元々動作していたリサイズ機能の復旧

#### 修復対象ファイル:
1. **CanvasComponent.tsx**
   - `handleCanvasMouseDown` 関数のリサイズハンドル判定処理
   - `handleCanvasMouseMove` 関数のリサイズ実行処理
   - リサイズフラグ管理の修正

2. **BubbleRenderer.tsx**
   - `isBubbleResizeHandleClicked` 関数の戻り値型統一
   - `resizeBubble` 関数の実装（8方向対応）

3. **CharacterRenderer.tsx**
   - `isCharacterResizeHandleClicked` 関数の戻り値型統一
   - `resizeCharacter` 関数の実装（スケール対応）

#### 修復の技術的要件:
- **8方向リサイズ**: nw, n, ne, e, se, s, sw, w の全方向対応
- **最小サイズ制限**: 吹き出し60x40px、キャラクター0.5倍スケール
- **最大サイズ制限**: キャラクター5.0倍スケール
- **リアルタイム反映**: ドラッグ中の即座サイズ変更

## 🏗️ ファイル構造（現在）
```
src/
├── types.ts                    # 共通型定義（SnapSettings追加）
├── App.tsx                     # メインアプリ（スナップ設定UI付き）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（600行、リサイズバグあり）
│   ├── UI/
│   │   ├── CharacterDetailPanel.tsx # キャラクター詳細設定
│   │   └── ExportPanel.tsx          # エクスポートUI
│   └── CanvasArea/
│       ├── PanelManager.ts          # パネル操作ロジック（350行）
│       ├── ContextMenuHandler.ts    # 右クリックメニュー処理（250行）
│       ├── CanvasDrawing.ts         # Canvas描画処理
│       ├── EditBubbleModal.tsx      # 編集モーダル
│       ├── templates.ts             # パネルテンプレート定義
│       ├── sceneTemplates.ts        # シーンテンプレート定義
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作（リサイズバグあり）
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（リサイズバグあり）
│           └── PanelRenderer.tsx     # パネル描画・操作
├── services/
│   └── ExportService.ts        # エクスポート機能中核
```

## プロジェクト達成状況

### Phase 1-7: 基本〜応用機能 ✅
- 全ての基本機能完了済み

### Phase 8: スナップ設定UI＆コード分割 🟡 **部分完了**
- **✅ スナップ設定UI**: 完全実装済み
- **✅ コード分割**: PanelManager・ContextMenuHandler分離完了
- **❌ リサイズ機能**: 分割作業中に破損

### **Phase 8.1: リサイズ機能緊急修復** 🔜 **次のタスク**
- リサイズ機能の完全復旧が最優先

### Phase 9: 次世代機能 🔜
- ズーム機能、ルーラー機能、残コード分割完了

**現在の進捗率: 95% 完了（リサイズバグにより5%減）** 🚧

## 🎯 緊急対応方針

### **短期目標（1日以内）**
1. **🚨 リサイズ機能修復**: 最優先で動作復旧
2. **🧪 全機能テスト**: 修復後の動作確認

### **中期目標（1週間）**
1. **🔍 ズーム機能実装**: マウスホイール + Ctrl でズーム
2. **📏 ルーラー・ガイド機能実装**: より正確な配置支援

### **長期目標（1ヶ月）**
1. **🎨 背景・小物システム実装**: 効果線・集中線の追加
2. **🤖 ChatGPT API連携**: AIによるストーリー相談機能

## 📝 **開発者メモ**

### **疲労度**: 高 😓
### **問題の性質**: 既存機能の破損（新機能開発ではない）
### **緊急度**: 最高（基本機能に影響）
### **修復見積もり**: 1-2時間の集中作業

**次回作業時は、リサイズ機能の修復から開始すること。**
**新機能追加は、既存機能の完全復旧後に実施する。**