# ネーム制作ツール - プロジェクト状況ファイル

## 基本情報
- **プロジェクト名**: React製ネーム制作支援ツール
- **技術スタック**: React + TypeScript + HTML5 Canvas
- **開発開始**: 2025年9月8日
- **最終更新**: 2025年9月8日（キャラクター人間化・表情/ポーズシステム完了）

## 現在の実装状況

### ✅ 完了機能
- **基本Canvas描画**: パネル、キャラクター、吹き出しの表示
- **吹き出し機能**: 
  - 自由移動（パネル外移動可能）
  - 3方向リサイズ（上下端/左右端/四隅で操作分岐）
  - ダブルクリック編集
  - 4種類の形状（普通/叫び/小声/心の声）
- **✅ キャラクター機能（大幅人間化）**: 
  - 絶対座標での自由移動（パネル外移動可能）
  - 8方向リサイズハンドル（吹き出しと同じ方式）
  - 表示タイプ切り替え（顔のみ/上半身/全身）
  - 4種類のキャラクター（主人公/ヒロイン/ライバル/友人）
  - **✅ 4方向の体の向き**: 正面/左/右/後ろ（簡略化により直感的に）
  - **✅ 5方向の視線**: 正面/左/右/上/下（シンプルで分かりやすく）
  - **✅ サイズ制限拡張**: 最大4.0倍まで拡大可能
  - **🆕 8種類の表情システム**: 
    - ふつう/にっこり/かなしい/おこってる/びっくり/てれてる/こまった/ねむい
    - 各表情に応じた目・口・眉毛の詳細描画
    - 照れ表情での自動頬赤らめ効果
  - **🆕 7種類のポーズシステム**:
    - 立ってる/座ってる/歩いてる/指さし/手を振る/腕くみ/考えてる
    - ポーズに応じた腕・脚・体の描画変化
    - 歩行時の自然な腕と脚の動き
  - **🆕 人間らしい描画システム**:
    - 髪と顔の完全分離（髪→顔の順で描画）
    - キャラクタータイプ別髪型（主人公：普通/ヒロイン：長髪/ライバル：尖髪/友人：ウェーブ）
    - 自然な肌色とプロポーション
    - 表情に応じた目のサイズ・形状変化
    - リアルな眉毛の角度変化
- **テンプレート機能**: 
  - 6種類のパネルレイアウト
  - 8種類のシーンテンプレート（基本5種類 + 感情表現3種類）
  - **✅ 恋愛シーン**: 照れた表情で心理描写
  - **✅ 緊張シーン**: 後ろ向きと不安表情の組み合わせ
  - **✅ 驚きシーン**: 驚き表情と上方向視線
- **操作機能**:
  - アンドゥ/リドゥ機能（Ctrl+Z/Ctrl+Y）
  - 要素削除（Backspace/Delete）
  - キーボードショートカット対応
  - 右クリックコンテキストメニュー（詳細設定・編集・削除）
- **UI機能**:
  - デフォルトダークモード
  - ライト/ダークモード切り替え
  - 左右サイドバーレイアウト
  - **✅ 改良版キャラクター詳細設定パネル**: 
    - 絵文字アイコンによる直感的なUI
    - 表情・ポーズの視覚的選択
    - プレビュー機能付き
    - レスポンシブ対応
- **ファイル分割**: 保守性向上のための構造化
- **型定義統一**: TypeScriptによる型安全性

### 🔄 進行中
- なし（人間化システム完了）

### 🐛 既知のバグ（要修正）
1. **吹き出し追加バグ**: パネル未選択状態で吹き出し追加が機能しない
   - 「パネル未選択でも追加可能」と表示されているが実際は追加されない
   - App.tsx の addBubbleFunc 呼び出し処理に問題がある可能性

2. **シーンテンプレート配置バグ**: どのパネルを選択してもパネル1に配置される
   - sceneTemplates.ts の applySceneTemplate 関数が常に panels[0] を使用
   - 選択中のパネルを優先すべき

### 🚀 追加したい機能
1. **パネルテンプレート自動配置**
   - パネルテンプレート選択時にキャラクターと吹き出しをデフォルト配置
   - 各テンプレートに適したシーン構成を自動生成

2. **表情・ポーズ拡張**
   - より多くの表情バリエーション（困惑、興奮、眠気など）
   - 動的ポーズ（走る、ジャンプ、転ぶなど）

3. **新シーンテンプレート拡張**
   - バトルシーン: 動きのあるポーズ組み合わせ
   - 思い出シーン: 過去を振り返る表現
   - コメディシーン: 大げさな表情とポーズ

### ❌ 未実装・低優先度
1. **エクスポート機能**: PDF、PNG、クリスタ用データ出力
2. **パフォーマンス最適化**: 大量要素での描画最適化
3. **レスポンシブ対応**: モバイル端末での操作性向上

## ファイル構造
```
src/
├── types.ts                    # 共通型定義（表情・ポーズ対応型完了）
├── App.tsx                     # メインアプリ（新シーンテンプレート対応）
├── components/
│   ├── CanvasComponent.tsx     # Canvas操作中核（座標系統一済み）
│   ├── UI/
│   │   └── CharacterDetailPanel.tsx # キャラクター詳細設定（絵文字UI完了）
│   └── CanvasArea/
│       ├── EditBubbleModal.tsx # 編集モーダル
│       ├── templates.ts        # パネルテンプレート定義
│       ├── sceneTemplates.ts   # シーンテンプレート定義（表情活用完了）
│       └── renderers/
│           ├── BubbleRenderer.tsx    # 吹き出し描画・操作
│           ├── CharacterRenderer.tsx # キャラクター描画・操作（人間化完全対応）
│           └── PanelRenderer.tsx     # パネル描画・操作（ダークモード対応）
```

## 重要な技術詳細

### 座標系（統一済み）
- **吹き出し**: 絶対座標（キャンバス内自由移動）
- **キャラクター**: 絶対座標（新規）+ 相対座標（既存・互換性）
- **パネル**: 絶対座標

### 操作方式（改善済み）
- **吹き出しリサイズ**: 領域ベース判定（上下端/左右端/四隅/中央）
- **キャラクターリサイズ**: 領域ベース判定（吹き出しと同じ方式）
- **移動**: ドラッグ&ドロップ（パネル外移動可能）

### ✅ キャラクター表現システム（人間化完全実装済み）

#### 描画レイヤー構造
1. **頭の基本形状**: 自然な楕円形の肌色
2. **髪の毛**: キャラクタータイプ別（主人公/ヒロイン/ライバル/友人）
3. **顔の特徴**: 眉毛 → 目 → 鼻 → 口の順

#### 表情システム（8種類）
- **ふつう** 😐: 標準的な穏やかな表情
- **にっこり** 😊: 大きな笑顔、目も細くなる
- **かなしい** 😢: 下向きの口、垂れ眉
- **おこってる** 😠: きつめの眉、への字口
- **びっくり** 😲: 大きな目と口、眉が上がる
- **てれてる** 😳: 自動頬赤らめ + 小さな笑顔
- **こまった** 😰: 波線の口、困った眉
- **ねむい** 😴: 線状の目、小さな口

#### ポーズシステム（7種類）
- **立ってる** 🧍: 基本姿勢、自然な腕配置
- **座ってる** 🪑: 短い胴体、座った脚
- **歩いてる** 🚶: 傾いた体、前後に振れる腕と脚
- **指さし** 👉: 前に伸ばした腕と指
- **手を振る** 👋: 上に上げた腕、回転アニメーション
- **腕くみ** 🤝: 胸の前で交差した腕
- **考えてる** 🤔: 顎に手を当てるポーズ

#### キャラクタータイプ別髪型
- **主人公**: 普通の短髪（茶色）
- **ヒロイン**: 長髪+サイドヘア（明るい茶色）
- **ライバル**: 尖った髪（濃いグレー）
- **友人**: ウェーブヘア+装飾（明るい茶色）

### 状態管理
- React useState でローカル管理
- 親子間コールバック方式
- アンドゥ/リドゥ用操作履歴管理

## 起動方法
```bash
npm start
# http://localhost:3000 でアクセス
```

## 次回開発時の優先事項

### 🔥 緊急度：高（バグ修正）
1. **吹き出し追加バグ修正**
   - App.tsx の handleBubbleClick 関数確認
   - addBubbleFunc の呼び出しタイミング検証

2. **シーンテンプレート配置バグ修正**
   - sceneTemplates.ts の applySceneTemplate 関数修正
   - 選択パネル優先ロジックの実装

### 📈 重要度：中（機能追加）
1. **パネルテンプレート自動配置**
   - templates.ts にデフォルトシーン定義追加
   - テンプレート選択時の自動配置ロジック

2. **表情・ポーズ拡張**
   - 新しい表情: 困惑、興奮、あくび など
   - 新しいポーズ: 走る、ジャンプ、しゃがむ など

### 🎨 重要度：低（UI改善）
1. **操作説明の充実**
2. **プリセット保存機能**

## ✅ キャラクター人間化の完全実装内容

### 完了した作業
- [x] キャラクター描画の完全分離（髪・顔・体）
- [x] 8種類の表情システム実装
- [x] 7種類のポーズシステム実装
- [x] キャラクタータイプ別髪型システム
- [x] 表情に応じた顔パーツの詳細変化
- [x] ポーズに応じた体・腕・脚の描画変化
- [x] CharacterDetailPanel の絵文字UI化
- [x] プレビュー機能付きUI

### 技術的成果
- **表情表現**: 目・口・眉毛の形状を表情に応じて動的変更
- **ポーズ表現**: 体の傾き、腕の位置、脚の配置を自然に表現
- **髪型システム**: キャラクタータイプ別の個性的な髪型
- **UI改善**: 絵文字とテキストによる直感的な操作

### 新機能の使い方

#### キャラクター詳細設定
1. **キャラクター右クリック** → 詳細設定パネル表示
2. **表情選択**: 8種類の絵文字ボタンから選択
   - 😐 ふつう → 😊 にっこり → 😢 かなしい など
3. **ポーズ選択**: 7種類の絵文字ボタンから選択
   - 🧍 立ってる → 🚶 歩いてる → 👉 指さし など
4. **体の向き**: 4方向から選択（正面/左/右/後ろ）
5. **視線**: 5方向から選択（正面/左/右/上/下）
6. **サイズ**: 0.5〜4.0倍まで調整可能

#### 表情とポーズの組み合わせ例
- **会話シーン**: にっこり + 立ってる
- **驚きシーン**: びっくり + 指さし
- **緊張シーン**: こまった + 腕くみ
- **リラックス**: ねむい + 座ってる
- **アクティブ**: にっこり + 歩いてる

## よくある問題と解決法
- **リサイズが効かない**: 状態管理（isDragging, isBubbleResizing）のリセット確認
- **座標がずれる**: 絶対座標と相対座標の計算ミス
- **型エラー**: types.ts の型定義確認（表情・ポーズの型追加確認）
- **要素が追加されない**: パネル存在確認とコールバック関数の設定確認
- **✅ 表情が表示されない**: CharacterRenderer.tsx の新しい表情描画関数が呼ばれているか確認（完了）
- **✅ ポーズが反映されない**: bodyPose プロパティの更新確認（完了）

## 前回セッションでの教訓
- 座標系統一により操作性が大幅に向上
- アンドゥ/リドゥ機能で作業効率が改善
- 左右レイアウトで画面を有効活用
- **✅ 人間らしい表現**: 表情とポーズの組み合わせで豊かな表現が可能に
- **✅ UI設計の重要性**: 絵文字を使った直感的なUIで使いやすさ大幅向上
- **✅ 段階的な改良**: 既存機能を壊さずに新機能を安全に追加

## 開発フロー
1. **バグ修正** → **機能追加** → **UI改善** の順で進める
2. **部分的な修正・追加** → **テスト** → **コミット** を習慣化
3. **既存機能を壊さない**安全な開発を重視
4. **ユーザーフィードバック**を積極的に収集

## クイックスタート（新しいClaude向け）
このファイルを提示して「この状態から開発を続けてください」と言えば、現在の実装状況を把握して開発を継続できます。

**現在の状況**:
- 基本機能は完成済み
- 座標系統一・UI改善完了
- **✅ キャラクター人間化システム**: 完全実装済み
- **✅ 表情・ポーズシステム**: 8種類表情・7種類ポーズ対応
- バグ修正と残り機能実装が次のフェーズ

**次の目標**: 
1. 吹き出し追加バグとシーンテンプレート配置バグの修正
2. パネルテンプレート自動配置機能
3. 表情・ポーズシステムの更なる拡張

## 🆕 今回の作業内容（2025-09-08 キャラクター人間化）

### 完了した作業
- [x] CharacterRenderer.tsx の完全書き換え（人間らしい描画）
- [x] 髪と顔の完全分離システム
- [x] 8種類表情システム（目・口・眉毛の詳細変化）
- [x] 7種類ポーズシステム（体・腕・脚の自然な動き）
- [x] キャラクタータイプ別髪型（4種類）
- [x] CharacterDetailPanel の絵文字UI化
- [x] プレビュー機能とレスポンシブ対応

### 技術的成果
- **表情の詳細表現**: 照れ表情での自動頬赤らめ、眠い時の線状の目など
- **自然なポーズ**: 歩行時の腕と脚の連動、座った時の体型変化など
- **キャラクター個性**: 髪型による4キャラクターの差別化
- **直感的UI**: 絵文字ボタンによる視覚的操作

### 使用技術詳細
- **Canvas 2D API**: ellipse, roundRect, quadraticCurveTo など高度な描画
- **React Hooks**: useState による状態管理
- **TypeScript**: 型安全な表情・ポーズ管理
- **CSS-in-JS**: ダークモード対応の動的スタイリング

## 開発コマンド
```bash
# 開発サーバー起動
npm start

# ビルド
npm run build

# 型チェック
npx tsc --noEmit

# Git保存
git add .
git commit -m "完了: キャラクター人間化システム（8種類表情・7種類ポーズ・絵文字UI）"
git push origin main
```

## パフォーマンス注意点
- **描画最適化**: 表情・ポーズ変更時の再描画を最小限に
- **メモリ管理**: 大量のキャラクター作成時の負荷を監視
- **UI応答性**: 詳細設定パネルの開閉をスムーズに

## 将来の拡張可能性
1. **アニメーション**: 歩行や手振りの動的アニメーション
2. **感情システム**: 表情とポーズの自動組み合わせ
3. **キャラクター作成**: ユーザー独自キャラクターの作成機能
4. **AI支援**: 文章から適切な表情・ポーズの自動選択